source('CONVERSE.A')
index(70)

id(70)
name('Dale')

description:
    print('a short, barrel-chested man.')

    f3()

interaction:
    wait()

    print('\n"A good $T to thee, Avatar."')
    jump label_107

label_72:
    print('\n"Anything else can I do for thee?"')

label_107:
    print('\n')

    ask()

    case 'name':
        print('"I am Dale the @Glassblower."')
        setBit(byte 235, value 0)
        jump label_107

    case 'job':
        print('"I make @glassware, the finest in the land!"')
        jump label_107

    case 'glas':
        print('"If you\'d like to @buy some of my glassware, just say the word!"')
        jump label_107

    case 'swor':
        print('"Aye, I know how to make glass swords."')
        wait()

        print('\n\n"But there is little @demand for them."')
        jump label_107

    case 'dema':
        print('"I require five gems for the crafting. This is too expensive for ')
        print('most."')
        wait()

        print('\n\n"Aye, but things of @beauty they are..."')
        jump label_107

    case 'beau':
        print('"Thou seemst like a person who appreciates art."')
        wait()

        print('\n\n"I\'ll make thee one, if thou hast the @gems."')
        jump label_107

    case 'crys':
    case 'lens':
    case 'tele':
        print('"Hmmm...You\'d have to see a lensmaker about that."')
        wait()

        print('\n\n"I hear there\'s one near the Lycaeum."')
        jump label_107

    case 'buy':
        if notEquals(integer(value 32), byte 144):
            print('"Come to my shop when it\'s open!"')
            jump label_107

        else:
            jump label_1553
        fi

    case 'gems':
        if notEquals(integer(value 32), byte 144):
            print('"Come to my shop when it\'s open!"')
            jump label_107
        fi

        integer(value 0) = partyHasObject(byte 77, byte 0)

        if equals(integer(value 0), word 32769):
            print('"Aye, a glass sword needs fine gems to complete its beauty!"')
            jump label_107

        else:
            jump label_963
        fi

    case 'bye':
        print('"A fine $T to thee!"\n')
        bye()

    case '*':
        print('"Sorry?"')
        jump label_107
    esac

label_963:
    look(integer(value 0))

    if less(objectsCount(integer(value 0), byte 77), byte 5):
        print('"Sorry, $Y, you haven\'t enough gems."')
        jump label_107
    fi

    print('"Aye, $Y, I see the gems you carry."')
    wait()

    print('\n\n"Dost thou wish me to craft thee a glass sword?" ')

    choice('yn')

    case 'y':
        print('"It will cost thee 5 gems! Art thou certain?" ')
        jump label_1230

    case 'n':
        print('"Hmm," he scowls, "perhaps I was mistaken about thee..."')
        jump label_107
    esac

label_1230:
    choice('yn')

    case 'y':
        if less(plus(canCarry(integer(value 0)), weight(byte 77, byte 5)), weight(byte 48, byte 1)):
            print('"But thou cannot carry such a sword!"')
            jump label_107
        fi

        destroyItem(integer(value 0), byte 77, byte 0, byte 5)
        print('$N turns to the furnace and begins crafting the sword.')
        wait()

        print('\n\nSoon it is finished, and you marvel at its beauty!')
        wait()

        print('\n\n"There she is, and a finer work thou\'lt never see!"')
        createItem(integer(value 0), byte 48, byte 0, byte 1)
        jump label_107

    case 'n':
        print('"Hmm," he scowls, "perhaps I was mistaken about thee..."')
        jump label_107
    esac

label_1553:
    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 0
        jump label_1689
    fi

label_1573:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_1587:
    look(character(integer(value 0), byte 0))
    print('#2) $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_1587
    fi

    print('"Which of you?" ')
    inputInteger(integer(value 3))

    if equals(integer(value 3), byte 0):
        jump label_72
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_1573
    fi

label_1689:
    integer(value 3) = character(integer(value 3), byte 0)
    integer(value 0) = byte 1
    look(integer(value 3))

label_1710:
    string(value 0) = data(strings_2159, minus(integer(value 0), byte 1))
    print('#0) $0\n')
    integer(value 0) = plus(integer(value 0), byte 1)

    if notEquals(data(integers_2151, minus(integer(value 0), byte 1)), byte 0):
        jump label_1710
    fi

    integer(value 7) = integer(value 0)
    print('"Which item?" ')
    inputInteger(integer(value 0))

    if equals(integer(value 0), byte 0):
        jump label_72
    fi

    if greaterOrEquals(integer(value 0), integer(value 7)):
        jump label_1689
    fi

    integer(value 0) = minus(integer(value 0), byte 1)
    integer(value 1) = data(integers_2145, integer(value 0))
    string(value 1) = data(strings_2159, integer(value 0))
    print('"That $1 costs #1 gold."')
    wait()

    print('\n\n"Interested, $Y?" ')

    choice('yn')

    case 'y':
        jump label_1916

    case 'n':
        jump label_1689
    esac

label_1916:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(integers_2151, integer(value 0)), byte 1)):
        print('"But \'twould make thee o\'erburdened, $Y!"')
        wait()

        print('\n')
        jump label_72
    fi

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
        destroyItem(integer(value 3), byte 88, byte 0, integer(value 1))
        createItem(integer(value 3), data(integers_2151, integer(value 0)), byte 0, byte 1)
        print('"Excellent!"\n\nAfter accepting $Y\'s gold, $N hands over the $1.')
        wait()

        print('\n\n')
        jump label_1689

    else:
        print('"But thou hast not enough gold, $Y!"')
        wait()

        print('\n')
        jump label_72
    fi

integers_2145 = [
    5,  // 0
    5,  // 1
    85, // 2
]

integers_2151 = [
    118, // 0
    183, // 1
    123, // 2
    0,   // 3
]

strings_2159 = [
    'Glass',  // 0
    'Jar',    // 1
    'Mirror', // 2
]
