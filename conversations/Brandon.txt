source('CONVERSE.A')
index(79)

id(79)
name('Brandon')

description:
    print('a golden-haired young man.')
    wait()

interaction:
    integer(value 8) = byte 6

    if hasBit(byte 235, value 0):
        print('"Avatar! Good $T, $G! How has thy quest gone?"')

    else:
        print('"Hey! The Avatar! Good $T, $G!"')
        wait()

        print('\n\n"You\'ve come to me to aid thee in thy quest! What an honor!"')
        ('SETF', ('byte', 235), ('value', 0))
    fi

    wait()

    jump label_236

label_205:
    print('\n"What else can I do for thee?"\n')

label_236:
    print('\n')

    ask()

    case 'buy':
        print('"I have a large inventory, so be more specific:"')
        wait()

        print('\n\n"Dost thou want @arms or @armor?"')
        jump label_236

    case 'arms':
        if notEquals(integer(value 32), byte 144):
            print('"Come by my shop when I\'m open!"')
            jump label_236

        else:
            integer(value 9) = byte 0
            jump label_2157
        fi

    case 'armo':
        if notEquals(integer(value 32), byte 144):
            print('"Come by my shop when I\'m open!"')
            jump label_236

        else:
            integer(value 9) = integer(value 8)
            jump label_2157
        fi

    case 'sell':
        if notEquals(integer(value 32), byte 144):
            print('"Come by my shop when I\'m open!"')
            jump label_236

        else:
            jump label_1235
        fi

    case 'job':
        print('"Oh, I\'m not important like you. I\'m just a weaponsmith--and only a ')
        print('@journeyman at that."')
        jump label_236

    case 'jour':
        print('"Aye, just a few years ago I was a simple apprentice."')
        wait()

        print('\n\n"Now I @supply arms to all Trinsic!"')
        jump label_236

    case 'name':
        print('"My name\'s Brandon, $G, and I\'m honored to meet thee!"')
        jump label_236

    case 'join':
        print('"That would be a great honor! I\'d love to!"')
        wait()

        print('\n\nThe man comes to his senses.')
        wait()

        print('\n\n"But no, I can\'t. I\'ve responsibilites here, especially @now."')
        jump label_236

    case 'fine':
    case 'good':
    case 'grea':
    case 'okay':
    case 'well':
        print('"And glad I am to hear it!"')
        jump label_236

    case 'now':
    case 'supp':
        print('"I have to make @weapons to help fight the gargoyles!"')
        jump label_236

    case 'bye':
    case 'noth':
        print('"Farewell! May thy quest succeed, Avatar!"\n')
        bye()

    case 'weap':
        print('"Perhaps you\'d like to @buy some. I\'d be honored to have thee as a ')
        print('customer."')
        jump label_236

    case '*':
        print('"Beg pardon, $G?"')
        jump label_236
    esac

    // Unreachable code!
    jump label_236

label_1235:
    integer(value 0) = byte 0
    integer(value 2) = byte 0
    integer(value 3) = byte 0

label_1256:
    integer(value 1) = byte 0

label_1263:
    if hasObject(character(integer(value 0), byte 0), data(dword 2806, integer(value 1)), byte 0):
        data(dword 2975, integer(value 2)) = integer(value 0)
        integer(value 2) = plus(integer(value 2), byte 1)
        integer(value 3) = byte 1
        jump label_1343
    fi

    integer(value 1) = plus(integer(value 1), byte 1)

    if data(dword 2806, integer(value 1)):
        jump label_1263
    fi

label_1343:
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_1256
    fi

    if equals(integer(value 3), byte 0):
        print('"Sorry, none of you has anything I need."')
        wait()

        print('\n')
        jump label_205
    fi

    if equals(integer(value 2), byte 1):
        integer(value 3) = character(data(dword 2975, byte 0), byte 0)
        ('SETNAME', ('integer', [('value', 3)]))
        print('"Aye, $Y has something of interest..."')
        wait()

        print('\n\n')
        jump label_1620
    fi

label_1496:
    integer(value 1) = byte 1

label_1503:
    ('SETNAME', ('character', [('data', [('dword', 2975), ('minus', [('integer', [('value', 1)]), ('byte', 1)])]), ('byte', 0)]))
    print('#1) $Y\n')
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 2)):
        jump label_1503
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump label_2126
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greaterOrEquals(integer(value 3), integer(value 2)):
        jump label_1496
    fi

    integer(value 3) = character(data(dword 2975, integer(value 3)), byte 0)

label_1620:
    integer(value 0) = byte 0
    integer(value 5) = byte 0

label_1634:
    if equals(hasObject(integer(value 3), data(dword 2806, integer(value 0)), byte 0), byte 0):
        jump label_1681
    fi

    data(dword 2945, integer(value 5)) = integer(value 0)
    integer(value 5) = plus(integer(value 5), byte 1)

label_1681:
    integer(value 0) = plus(integer(value 0), byte 1)

    if data(dword 2806, integer(value 0)):
        jump label_1634
    fi

    if equals(integer(value 5), byte 1):
        integer(value 6) = data(dword 2945, byte 0)
        jump label_1845
    fi

    integer(value 0) = byte 1

label_1740:
    print('#0) ')
    ('DPRINT', ('dword', 2830), ('data', [('dword', 2945), ('minus', [('integer', [('value', 0)]), ('byte', 1)])]))
    print('\n')
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 5)):
        jump label_1740
    fi

    print('"Which item?" ')
    ('INPUTNUM', 6)

    if greater(integer(value 6), integer(value 5)):
        jump label_1620
    fi

    if equals(integer(value 6), byte 0):
        jump label_2126
    fi

    integer(value 6) = data(dword 2945, minus(integer(value 6), byte 1))

label_1845:
    string(value 0) = data(dword 2830, integer(value 6))
    integer(value 7) = divide(data(dword 2784, integer(value 6)), byte 2)
    ('SETNAME', ('integer', [('value', 3)]))
    print('"Will you take #7 gold for that $0, $Y?" ')

    choice('yn')

    case 'n':
        if equals(integer(value 5), byte 1):
            print('"Perhaps some other time, then."')
            wait()

            print('\n')
            jump label_205

        else:
            print('"Perhaps something else then?"')
            wait()

            print('\n\n')
            jump label_1620
        fi

    case 'y':
        ('SETNAME', ('integer', [('value', 3)]))
        print('"Done!" $N hands $Y #7 gold pieces and takes the $0.')
        ('DELETE', ('integer', [('value', 3)]), ('data', [('dword', 2806), ('integer', [('value', 6)])]), ('byte', 0), ('byte', 1))
        ('NEW', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 7)]))

        if equals(integer(value 5), byte 1):
            print('\n')
            jump label_205

        else:
            wait()

            print('\n\n')
            jump label_1620
        fi
    esac

label_2126:
    print('"Changed your mind, eh?"')
    wait()

    print('\n')
    jump label_205

label_2157:
    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 1
        jump label_2303
    fi

label_2177:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_2191:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#2) $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_2191
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump label_2126
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_2177
    fi

    integer(value 3) = character(integer(value 3), byte 0)

label_2303:
    integer(value 0) = byte 1

label_2310:
    string(value 0) = data(dword 2830, plus(integer(value 9), minus(integer(value 0), byte 1)))
    print('#0) $0\n')
    integer(value 0) = plus(integer(value 0), byte 1)

    if and(integer(value 9), notEquals(data(dword 2806, plus(integer(value 9), minus(integer(value 0), byte 1))), byte 0)):
        jump label_2310
    fi

    if and(equals(integer(value 9), byte 0), lessOrEquals(integer(value 0), integer(value 8))):
        jump label_2310
    fi

    integer(value 7) = integer(value 0)
    print('"Which item?" ')
    ('INPUTNUM', 0)

    if equals(integer(value 0), byte 0):
        jump label_2126
    fi

    if greaterOrEquals(integer(value 0), integer(value 7)):
        jump label_2303
    fi

    integer(value 0) = minus(plus(integer(value 9), integer(value 0)), byte 1)
    integer(value 1) = data(dword 2784, integer(value 0))
    string(value 1) = data(dword 2830, integer(value 0))
    print('"That $1 costs #1 gold."')
    wait()

    print('\n\n"Interested?" ')

    choice('yn')

    case 'y':
        jump label_2543

    case 'n':
        jump label_2303
    esac

label_2543:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(dword 2806, integer(value 0)), byte 1)):
        ('SETNAME', ('integer', [('value', 3)]))
        print('"But \'twould make thee o\'erburdened, $Y!"')
        wait()

        print('\n')
        jump label_205
    fi

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
        ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
        ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 2806), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 1))
        ('SETNAME', ('integer', [('value', 3)]))
        print('"Excellent!"\n\nAfter accepting $Y\'s gold, $N hands over the $1.')
        wait()

        print('\n\n')
        jump label_2303

    else:
        ('SETNAME', ('integer', [('value', 3)]))
        print('"But thou hast not enough gold, $Y!"')
        wait()

        print('\n')
        jump label_205
    fi

integers_2784 = [
    35,  // 0
    20,  // 1
    40,  // 2
    50,  // 3
    55,  // 4
    75,  // 5
    15,  // 6
    25,  // 7
    350, // 8
    200, // 9
    100, // 10
]

integers_2806 = [
    39, // 0
    35, // 1
    43, // 2
    45, // 3
    44, // 4
    46, // 5
    3,  // 6
    12, // 7
    23, // 8
    8,  // 9
    22, // 10
    0,  // 11
]

strings_2830 = [
    'Mace',         // 0
    'Main Gauche',  // 1
    'Sword',        // 2
    '2-Hnd Axe',    // 3
    '2-Hnd Hammer', // 4
    '2-Hnd Sword',  // 5
    'Iron Helm',    // 6
    'Kite Shield',  // 7
    'Magic Armour', // 8
    'Magic Helm',   // 9
    'Plate Mail',   // 10
]

integers_2945 = [
    0, // 0
    0, // 1
    0, // 2
    0, // 3
    0, // 4
    0, // 5
    0, // 6
    0, // 7
    0, // 8
    0, // 9
    0, // 10
    0, // 11
    0, // 12
    0, // 13
    0, // 14
]

integers_2975 = [
    0, // 0
    0, // 1
    0, // 2
    0, // 3
    0, // 4
    0, // 5
    0, // 6
    0, // 7
]
