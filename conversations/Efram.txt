source("CONVERSE.A")
index(22)

id(22)
name("Efram")

description:
    print("a grunting and grumbling man with a large stomach.\n")
    wait()

    print("\n")

interaction:
    if equals(integer(value 32), byte 144):
    jump 191

    endif

    print("\"Hrmmph! Well, I'm busy now.\"")
    wait()

    print("\n\n\"Hrmmph, yes, well, come back to my shop ")

    if greater(integer(value 17), byte 19):
    print("tomorrow morning")

    else:
    print("this afternoon")

    endif

    print(".\"\n")
    bye()

191:
    if hasBit(byte 235, value 0):
    jump 262

    endif

    print("\"Hrmmph. Hello.\" His breathing is quite heavy.")
    ('SETF', ('byte', 235), ('value', 0))
    wait()

    print("\n")
    jump 312

262:
    print("\"Hrmmph, well. Haven't we...never mind. Hrmmph.\"")
    wait()

    print("\n\n\"What do you need?\"\n")

312:
    print("\n\"What do you need?\"\n")

    ask()
    case "name":
    print("\"Efram the provisioner.\"\n")
    jump 333

    case "efra":
    print("\"It's a nice enough name, hrmmph.\"\n")
    jump 333

    case "buy":
    print("\"Which, @torches, @oil, @gems, @backpacks, @bags, @shovels, or @powder")
    print(" kegs?\"\n")
    jump 333

    case "job":
    print("\"I sell @torches, @oil, @gems, @backpacks, @bags, @shovels, and ")
    print("@powder kegs.\"\n")
    jump 333

    case "torc":
    integer(value 4) = byte 0
    jump 874

    case "oil,flas":
    integer(value 4) = byte 1
    jump 874

    case "gem":
    integer(value 4) = byte 2
    jump 874

    case "back":
    integer(value 4) = byte 3
    jump 874

    case "bags":
    integer(value 4) = byte 4
    jump 874

    case "shov":
    integer(value 4) = byte 5
    jump 874

    case "powd":
    integer(value 4) = byte 6
    jump 874

    case "bye":
    print("\"I'm glad you stopped by.\" He gives you a firm handshake.\n")
    bye()

    case "*":

    if random(byte 0, byte 1):
    print("\"I'm sorry?\"\n")

    else:
    print("\"Hrmmph, well, perhaps you could ask someone else.\"\n")

    endif

    jump 333

874:
    if equals(integer(value 23), byte 0):
    integer(value 3) = byte 0
    jump 1010

    endif

    integer(value 0) = byte 0
    integer(value 1) = byte 1
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print("#1. $Y\n")
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
    jump 908

    endif

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
    jump 312

    endif

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
    jump 894

    endif

    if or(less(plus(canCarry(character(integer(value 3), byte 0)), weight(byte 88, data(dword 1747, integer(value 4)))), weight(data(dword 1761, integer(value 4)), byte 1)), less(objectsCount(character(integer(value 3), byte 0), byte 88), data(dword 1747, integer(value 4)))):
    integer(value 5) = byte 1
    jump 1322

    endif

    integer(value 0) = data(dword 1747, integer(value 4))
    string(value 0) = data(dword 1775, integer(value 4))
    ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
    print("$N looks at $Y. \"It'll cost you #0 gold for each $0. How many do you ")
    print("want?\" ")
    ('INPUT', 5)

    if greater(integer(value 5), byte 100):
    print("\"Come now, that's a little much don't you think?\"")
    wait()

    print("\n\n")
    jump 1073

    endif

    if equals(integer(value 5), byte 0):
    print("$N frowns at $Y. \"Hrmmph. That was a fair price. Well...\"")
    wait()

    print("\n")
    jump 312

    endif

    integer(value 2) = integer(value 5)
    integer(value 0) = byte 0
    integer(value 1) = byte 0

    if less(plus(canCarry(character(integer(value 3), byte 0)), weight(byte 88, multiply(integer(value 2), data(dword 1747, integer(value 4))))), weight(data(dword 1761, integer(value 4)), integer(value 2))):
    integer(value 1) = byte 1
    integer(value 0) = byte 1
    integer(value 2) = minus(integer(value 2), byte 1)
    jump 1458

    endif

    if less(objectsCount(character(integer(value 3), byte 0), byte 88), multiply(integer(value 2), data(dword 1747, integer(value 4)))):
    integer(value 1) = byte 2
    integer(value 2) = minus(integer(value 2), byte 1)
    jump 1458

    endif

    jump 1643

1458:
    if integer(value 2):
    jump 1343

    endif

    if equals(integer(value 1), byte 1):
    string(value 0) = data(dword 1775, integer(value 4))
    ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
    print("$N looks at $Y. \"You haven't any room in your pack.\"")
    wait()

    print("\n")
    jump 312

    endif

    if equals(integer(value 1), byte 2):
    string(value 0) = data(dword 1775, integer(value 4))
    ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
    print("$N looks at $Y. \"A $0 costs more gold than you have.\"")
    wait()

    print("\n")
    jump 312

    endif

    ('DELETE', ('character', [('integer', [('value', 3)]), ('byte', 0)]), ('byte', 88), ('byte', 0), ('multiply', [('integer', [('value', 2)]), ('data', [('dword', 1747), ('integer', [('value', 4)])])]))
    ('NEW', ('character', [('integer', [('value', 3)]), ('byte', 0)]), ('data', [('dword', 1761), ('integer', [('value', 4)])]), ('byte', 0), ('integer', [('value', 2)]))
    ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
    string(value 0) = data(dword 1775, integer(value 4))
    print("He hands $Y #2 $0\\s. ")
    ('DPRINT', [('integer', [('value', 1)]), ('dword', 1829)])
    wait()

    print("\n")
    jump 312

1747:
    ['INTEGERS', [3, 4, 20, 10, 3, 15, 30]]

1761:
    ['INTEGERS', [90, 83, 77, 99, 188, 104, 223]]

1775:
    ['STRINGS', ['Torch', 'Flask of Oil', 'Gem', 'Backpack', 'Bag', 'Shovel', 'Powder Keg', '"There ya go."', '"That\'s all you can carry."', '"That\'s all you can afford."']]
