source('CONVERSE.A')
index(22)

id(22)
name('Efram')

description:
    print('a grunting and grumbling man with a large stomach.\n')
    wait()

    print('\n')

interaction:
    if equals(integer(value 32), byte 144):
        jump label_191
    fi

    print('"Hrmmph! Well, I\'m busy now."')
    wait()

    print('\n\n"Hrmmph, yes, well, come back to my shop ')

    if greater(integer(value 17), byte 19):
        print('tomorrow morning')

    else:
        print('this afternoon')
    fi

    print('."\n')
    bye()

label_191:
    if hasBit(byte 235, value 0):
        jump label_262
    fi

    print('"Hrmmph. Hello." His breathing is quite heavy.')
    ('SETF', ('byte', 235), ('value', 0))
    wait()

    print('\n')
    jump label_312

label_262:
    print('"Hrmmph, well. Haven\'t we...never mind. Hrmmph."')
    wait()

    print('\n\n"What do you need?"\n')

label_312:
    print('\n"What do you need?"\n')

label_333:
    ask()

    case 'name':
        print('"Efram the provisioner."\n')
        jump label_333

    case 'efra':
        print('"It\'s a nice enough name, hrmmph."\n')
        jump label_333

    case 'buy':
        print('"Which, @torches, @oil, @gems, @backpacks, @bags, @shovels, or @powder')
        print(' kegs?"\n')
        jump label_333

    case 'job':
        print('"I sell @torches, @oil, @gems, @backpacks, @bags, @shovels, and ')
        print('@powder kegs."\n')
        jump label_333

    case 'torc':
        integer(value 4) = byte 0
        jump label_874

    case 'flas':
    case 'oil':
        integer(value 4) = byte 1
        jump label_874

    case 'gem':
        integer(value 4) = byte 2
        jump label_874

    case 'back':
        integer(value 4) = byte 3
        jump label_874

    case 'bags':
        integer(value 4) = byte 4
        jump label_874

    case 'shov':
        integer(value 4) = byte 5
        jump label_874

    case 'powd':
        integer(value 4) = byte 6
        jump label_874

    case 'bye':
        print('"I\'m glad you stopped by." He gives you a firm handshake.\n')
        bye()

    case '*':
        if random(byte 0, byte 1):
            print('"I\'m sorry?"\n')

        else:
            print('"Hrmmph, well, perhaps you could ask someone else."\n')
        fi

        jump label_333
    esac

    // Unreachable code!
    jump label_333

label_874:
    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 0
        jump label_1010
    fi

label_894:
    integer(value 0) = byte 0
    integer(value 1) = byte 1

label_908:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#1. $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_908
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump label_312
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_894
    fi

label_1010:
    if or(less(plus(canCarry(character(integer(value 3), byte 0)), weight(byte 88, data(dword 1747, integer(value 4)))), weight(data(dword 1761, integer(value 4)), byte 1)), less(objectsCount(character(integer(value 3), byte 0), byte 88), data(dword 1747, integer(value 4)))):
        integer(value 5) = byte 1
        jump label_1322
    fi

label_1073:
    integer(value 0) = data(dword 1747, integer(value 4))
    string(value 0) = data(dword 1775, integer(value 4))
    ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
    print('$N looks at $Y. "It\'ll cost you #0 gold for each $0. How many do you ')
    print('want?" ')
    ('INPUT', 5)

    if greater(integer(value 5), byte 100):
        print('"Come now, that\'s a little much don\'t you think?"')
        wait()

        print('\n\n')
        jump label_1073
    fi

    if equals(integer(value 5), byte 0):
        print('$N frowns at $Y. "Hrmmph. That was a fair price. Well..."')
        wait()

        print('\n')
        jump label_312
    fi

label_1322:
    integer(value 2) = integer(value 5)
    integer(value 0) = byte 0
    integer(value 1) = byte 0

label_1343:
    if less(plus(canCarry(character(integer(value 3), byte 0)), weight(byte 88, multiply(integer(value 2), data(dword 1747, integer(value 4))))), weight(data(dword 1761, integer(value 4)), integer(value 2))):
        integer(value 1) = byte 1
        integer(value 0) = byte 1
        integer(value 2) = minus(integer(value 2), byte 1)
        jump label_1458
    fi

    if less(objectsCount(character(integer(value 3), byte 0), byte 88), multiply(integer(value 2), data(dword 1747, integer(value 4)))):
        integer(value 1) = byte 2
        integer(value 2) = minus(integer(value 2), byte 1)
        jump label_1458
    fi

    jump label_1643

label_1458:
    if integer(value 2):
        jump label_1343
    fi

    if equals(integer(value 1), byte 1):
        string(value 0) = data(dword 1775, integer(value 4))
        ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
        print('$N looks at $Y. "You haven\'t any room in your pack."')
        wait()

        print('\n')
        jump label_312
    fi

    if equals(integer(value 1), byte 2):
        string(value 0) = data(dword 1775, integer(value 4))
        ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
        print('$N looks at $Y. "A $0 costs more gold than you have."')
        wait()

        print('\n')
        jump label_312
    fi

label_1643:
    ('DELETE', ('character', [('integer', [('value', 3)]), ('byte', 0)]), ('byte', 88), ('byte', 0), ('multiply', [('integer', [('value', 2)]), ('data', [('dword', 1747), ('integer', [('value', 4)])])]))
    ('NEW', ('character', [('integer', [('value', 3)]), ('byte', 0)]), ('data', [('dword', 1761), ('integer', [('value', 4)])]), ('byte', 0), ('integer', [('value', 2)]))
    ('SETNAME', ('character', [('integer', [('value', 3)]), ('byte', 0)]))
    string(value 0) = data(dword 1775, integer(value 4))
    print('He hands $Y #2 $0\\s. ')
    ('DPRINT', ('dword', 1829), ('integer', [('value', 1)]))
    wait()

    print('\n')
    jump label_312

integers_1747 = [
    3,  // 0
    4,  // 1
    20, // 2
    10, // 3
    3,  // 4
    15, // 5
    30, // 6
]

integers_1761 = [
    90,  // 0
    83,  // 1
    77,  // 2
    99,  // 3
    188, // 4
    104, // 5
    223, // 6
]

strings_1775 = [
    'Torch',        // 0
    'Flask of Oil', // 1
    'Gem',          // 2
    'Backpack',     // 3
    'Bag',          // 4
    'Shovel',       // 5
    'Powder Keg',   // 6
]

strings_1829 = [
    '"There ya go."',                // 0
    '"That\'s all you can carry."',  // 1
    '"That\'s all you can afford."', // 2
]
