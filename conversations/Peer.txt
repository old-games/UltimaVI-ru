source("CONVERSE.A")
index(53)

id(53)
name("Peer")

description:
    print("a tall, muscled man with a wide grin.")
    wait()

    print("\n")

interaction:
    integer(value 5) = byte 0

    if hasBit(byte 235, value 0):
        print("He squints at you. \"We've met, haven't we?\"")

    else:
        print("\"Hello,\" he says, lumbering over to you and extending a large hand.")
        ('SETF', ('byte', 235), ('value', 0))

    endif

    wait()

    print("\n\n\"What can I do for ya?\"\n")

    ask()

    case "name":
        print("\"@Peer.\"")
        jump 204

    case "peer":
        print("\"My father was a @sailor, but couldn't spell.\" He laughs out loud.")
        jump 204

    case "fath":
    case "sail":
        print("\"And his father before him.\"")
        jump 204

    case "buy":
        if equals(hasObject(byte 235, byte 149, byte 0), byte 0):
            print("\"You bought my last craft!\"")
            jump 204

        endif

        print("\"I sell ")

        if or(hasObject(byte 235, byte 149, data(dword 1893, byte 0)), hasObject(byte 235, byte 149, data(dword 1893, byte 1))):
            print("@ships")
            integer(value 1) = byte 1

        else:
            integer(value 1) = byte 0

        endif

        if equals(or(hasObject(byte 235, byte 149, data(dword 1893, byte 2)), hasObject(byte 235, byte 149, data(dword 1893, byte 3))), byte 0):
            print(".\"")
            jump 204

        endif

        if integer(value 1):
            print(" and ")

        endif

        print("@skiffs.\"")
        jump 204

    case "ship":
        if hasObject(byte 235, byte 149, data(dword 1893, byte 0)):
            integer(value 9) = byte 0
            jump 1010

        endif

        if hasObject(byte 235, byte 149, data(dword 1893, byte 1)):
            integer(value 9) = byte 1
            jump 1010

        endif

        print("\"Sorry, I sold you my last ship.\"")
        jump 204

    case "skif":
        if hasObject(byte 235, byte 149, data(dword 1893, byte 2)):
            integer(value 9) = byte 2
            jump 1010

        endif

        if hasObject(byte 235, byte 149, data(dword 1893, byte 3)):
            integer(value 9) = byte 3
            jump 1010

        endif

        print("\"Sorry, I sold you my last skiff.\"")
        jump 204

    case "job":
        if equals(hasObject(byte 235, byte 149, byte 0), byte 0):
            print("\"I used to sell ships and skiffs.\"")
            wait()

            print("\n\n\"But you bought them all!\"")
            jump 204

        endif

        print("\"I sell ")

        if or(hasObject(byte 235, byte 149, data(dword 1893, byte 0)), hasObject(byte 235, byte 149, data(dword 1893, byte 1))):
            print("@ships")
            integer(value 1) = byte 1

        else:
            integer(value 1) = byte 0

        endif

        if equals(or(hasObject(byte 235, byte 149, data(dword 1893, byte 2)), hasObject(byte 235, byte 149, data(dword 1893, byte 3))), byte 0):
            print(".\"")
            jump 204

        endif

        if integer(value 1):
            print(" and ")

        endif

        print("@skiffs.\"")
        jump 204

    case "bye":
        print("\"So long friend.\" He lumbers back to his work.\n")
        bye()

    case "*":
        print("\"That's a puzzler.\"")
        jump 204

        // Unreachable code!

    esac

1010:
    integer(value 5) = byte 0

    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 0
        jump 1153

    endif

1037:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

1051:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print("#2) $Y\n")
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump 1051

    endif

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump 1465

    endif

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump 1037

    endif

1153:
    integer(value 3) = character(integer(value 3), byte 0)
    integer(value 4) = data(dword 1885, integer(value 9))
    ('SETNAME', ('integer', [('value', 3)]))
    print("$N turns to $Y. \"It'll cost you #4 gold for the deed. Interested?\" ")

    askc("yn")

    case "y":
        if less(plus(canCarry(integer(value 3)), weight(byte 88, data(dword 1885, string(value 9)))), weight(byte 149, byte 1)):
            print("\"You look pretty full to me, $Y.\"")
            jump 204

        endif

        if less(objectsCount(integer(value 3), byte 88), data(dword 1885, integer(value 9))):
            jump 1531

        else:
            ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('data', [('dword', 1885), ('integer', [('value', 9)])]))
            jump 1371

        endif

    case "n":
        jump 1465

        // Unreachable code!

    esac

1371:
    ('GIVE', ('byte', 149), ('data', [('dword', 1893), ('integer', [('value', 9)])]), ('byte', 235), ('integer', [('value', 3)]))
    print("\"Excellent!\" After accepting the gold, $N hands $Y the deed.")
    integer(value 5) = byte 1
    wait()

    print("\n\n")
    jump 1465

1465:
    if integer(value 5):
        print("\"Sail her straight.\"")

    else:
        print("\"You'll ne'er find a better craft.\"")

    endif

    jump 204

1531:
    if equals(integer(value 23), byte 0):
        print("\"Thou hast not enough gold.\"")
        jump 204

    endif

    integer(value 1) = data(dword 1885, integer(value 9))
    integer(value 2) = byte 0
    integer(value 6) = byte 0
    integer(value 4) = byte 0

1606:
    if greater(integer(value 6), integer(value 23)):
        print("\"Thy party hast not enough gold.\"")
        jump 204

    endif

    integer(value 5) = objectsCount(character(integer(value 6), byte 0), byte 88)

    if less(integer(value 5), integer(value 1)):
        integer(value 1) = minus(integer(value 1), integer(value 5))
        integer(value 2) = plus(integer(value 2), integer(value 5))
        integer(value 6) = plus(integer(value 6), byte 1)
        jump 1606

    else:
        print("Your party takes up a collection to purchase the vessel.")
        integer(value 1) = word 400
        integer(value 2) = byte 0
        integer(value 4) = integer(value 6)
        integer(value 6) = byte 0
        jump 1799

        // Unreachable code!

    endif

1799:
    if equals(integer(value 6), integer(value 4)):
        ('DELETE', ('character', [('integer', [('value', 6)]), ('byte', 0)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
        wait()

        print("\n\n")
        jump 1371

    endif

    integer(value 5) = objectsCount(character(integer(value 6), byte 0), byte 88)
    integer(value 1) = minus(integer(value 1), integer(value 5))
    ('DELETE', ('character', [('integer', [('value', 6)]), ('byte', 0)]), ('byte', 88), ('byte', 0), ('integer', [('value', 5)]))
    integer(value 6) = plus(integer(value 6), byte 1)
    jump 1799

    [['INTEGERS', [200, 200, 30, 30]]]
    [['INTEGERS', [3, 4, 130, 131]]]
