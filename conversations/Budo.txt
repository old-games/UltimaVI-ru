source('CONVERSE.B')
index(16)

id(115)
name('Budo')

description:
    print('a chubby, jovial merchant.\n')

interaction:
    print('"Good $T! ')

    if hasBit(byte 235, value 0):
        jump label_339
    fi

    setBit(byte 235, value 0)
    print('I bet you\'ve come back to pick up that @orrery you ordered."')
    wait()

    if partyHas(byte 2):
        portrait(byte 2)
        print('\n\n"Don\'t be ridiculous! This is the first time we\'ve ever been in your')
        print(' shop!" says Dupre.')
        wait()

        portrait(byte 235)
        print('\n\n"Oh, I\'m sorry. I must have thought you were somebody you aren\'t.')

    else:
        print('\n\n"I\'m afraid it still hasn\'t arrived.')
    fi

    print('"')
    wait()

    print('\n\n"Do you need to buy some supplies?" ')

    choice('yn')

    case 'y':
        print('"Which, @torches, @oil, @lockpicks, @gems, @backpacks, @bags, ')
        print('@shovels, or @powder kegs?"')
        jump label_601

    case 'n':
        print('"Then it must be Thursday--or possibly Tuesday."')
        wait()

        print('\n\n"I never seem to sell anything on Tuesdays."')
        jump label_601

label_577:
        print('"What can I do you for?"')

label_601:
        print('\n')

        ask()

    case 'name':
        print('"Why, it\'s Budo, I believe. That\'s what it was last week."')
        wait()

        print('\n\n"Some call me \'the @Den\', but I don\'t think that\'s my name."')
        jump label_601

    case 'den':
        print('"I think someone told me that was @Nick\'s name."')
        jump label_601

    case 'nick':
        print('"I\'ve never met him, myself."')
        jump label_601

    case 'orre':
        print('"I don\'t know what it is, but I\'ve got one on order."')
        jump label_601

    case 'job':
        print('"Oh, I sell this and that."')
        wait()

        print('\n\n"I\'m not sure what \'this\' and \'that\' are, but I @sell a lot of ')
        print('them!"')
        wait()

        print('\n\n"People give me @money for them, that is."')
        jump label_601

    case 'mone':
        print('"It\'s not as sweet as @honey, but you can trade one for the other."')
        jump label_601

    case 'hone':
    case 'swee':
        print('"I like honey."')
        jump label_601

    case 'belt':
    case 'guil':
    case 'thie':
        if hasBit(byte 235, byte 7):
            print('"To keep the guild safe, each member only knows the names of two ')
            print('others."')
            wait()

            print('\n\n"You\'re safer not knowing more about the guild than you have to, ')
            print('believe me..."')
            jump label_601
        fi

        if notEquals(partyHasObject(byte 25, byte 0), word 32769):
            print('He glances about quickly, to make sure nobody else is listening.')
            wait()

            print('\n\nIn a low voice he says, "Congratulations, and welcome to the guild."')
            wait()

            print('\n\n"I can offer you the standard member\'s discount on all supplies ')
            print('now."')
            wait()

            print('\n\n"Just remember, whatever you do, don\'t tell anyone about our ')
            print('@guild!"')
            setBit(byte 235, byte 7)
            jump label_601
        fi

        print('A startling change comes over his features.')
        wait()

        print('\n\nSuddenly the good-natured bumbler that stood before you has been ')
        print('transformed into a shrewd, sharp, dangerous looking man.')
        wait()

        print('\n\nHe leans forward staring straight into your eyes as he asks "Who ')
        print('sent you?"\n')

        ask()
        print('\n"Uh-huh. Well... Were you hoping to join?" ')
        jump label_2414

    case 'buy':
    case 'sell':
    case 'that':
    case 'this':
        print('"Which, @torches, @oil, @lockpicks, @gems, @backpacks, @bags, ')
        print('@shovels, or @powder @kegs?"')
        jump label_601

    case 'torc':
        integer(value 4) = byte 0
        jump label_3392

    case 'oil':
        integer(value 4) = byte 1
        jump label_3392

    case 'lock':
        integer(value 4) = byte 2
        jump label_3392

    case 'gem':
        integer(value 4) = byte 3
        jump label_3392

    case 'back':
        integer(value 4) = byte 4
        jump label_3392

    case 'bags':
        integer(value 4) = byte 5
        jump label_3392

    case 'shov':
        integer(value 4) = byte 6
        jump label_3392

    case 'keg':
    case 'powd':
        integer(value 4) = byte 7
        jump label_3392

    case 'bye':
        if hasBit(byte 235, byte 7):
            print('He winks at you. "The guild is behind you, as long as you keep our ')
            print('secret."\n')

        else:
            print('"Ta ta for now."\n')
        fi

        bye()

    case '*':
        print('"$Z? It seems to me I knew something about that, but I\'m having ')
        print('trouble with my remembering."')
    esac

    jump label_601

label_2414:
    choice('yn')

    case 'n':
        print('He leans even closer, transfixing you with his gaze.')
        wait()

        print('\n\n"Then just remember this. I don\'t take kindly to anyone spreading ')
        print('secrets around."')
        wait()

        print('\n\n"If you were to tell anyone I\'m involved with the guild, well..."')
        wait()

        print('\n\n"Let\'s just say accidents can happen to anyone--even the Avatar."')
        wait()

        print('\n\n"Now get out of my shop."\n')
        bye()

    case 'y':
        print('"All right, maybe you\'ve got what it takes. We\'ll see."')
        wait()

        print('\n\n"To be a member of the thieves\' guild, you have to get your own ')
        print('belt."')
        wait()

        print('\n\n"Now we have a limited membership, so there\'s only so many belts in ')
        print('the world."')
        wait()

        print('\n\n"If you want one of them, you have to \'retire\' a member of the ')
        print('guild."')
        wait()

        print('\n\n"Lucky for you, it just happens there\'s a member we\'d like to see ')
        print('\'retired\' soon."')
        wait()

        print('\n\n"Her hideout is deep below Britain, in the sewers. You\'d best watch ')
        print('out for the rats down there!"')
        wait()

        print('\n\n"One last thing... It\nwould be an embarassment for the guild to have')
        print(' bodies turning up inconveniently."')
        wait()

        print('\n\n"So don\'t get too violent unless you have to."')
        wait()

        print('\n\n"I\'ll talk to you when you get back."\n')
        bye()
    esac

label_3392:
    if hasBit(byte 235, byte 7):
        data(dword 4379, byte 0) = data(dword 4395, byte 0)
        data(dword 4379, byte 1) = data(dword 4395, byte 1)
        data(dword 4379, byte 2) = data(dword 4395, byte 2)
        data(dword 4379, byte 3) = data(dword 4395, byte 3)
        data(dword 4379, byte 4) = data(dword 4395, byte 4)
        data(dword 4379, byte 5) = data(dword 4395, byte 5)
        data(dword 4379, byte 6) = data(dword 4395, byte 6)
        data(dword 4379, byte 7) = data(dword 4395, byte 7)
    fi

    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 0
        jump label_3688
    fi

label_3572:
    integer(value 0) = byte 0
    integer(value 1) = byte 1

label_3586:
    look(character(integer(value 0), byte 0))
    print('#1. $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_3586
    fi

    print('"Which of you?" ')
    inputNumber(integer(value 3))

    if equals(integer(value 3), byte 0):
        jump label_577
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_3572
    fi

label_3688:
    if or(less(canCarry(character(integer(value 3), byte 0)), weight(data(dword 4411, integer(value 4)), byte 1)), less(objectsCount(character(integer(value 3), byte 0), byte 88), data(dword 4379, integer(value 4)))):
        integer(value 5) = byte 1
        jump label_3973
    fi

label_3739:
    integer(value 0) = data(dword 4379, integer(value 4))
    string(value 0) = data(dword 4427, integer(value 4))
    look(character(integer(value 3), byte 0))
    print('$N looks at $Y, "It\'ll cost you #0 gold for each $0, how many do you ')
    print('want?" ')
    input(integer(value 5))

    if greater(integer(value 5), byte 100):
        print('"Come now, that\'s a little much don\'t you think?"')
        wait()

        print('\n\n')
        jump label_3739
    fi

    if equals(integer(value 5), byte 0):
        print('$N frowns at $Y, "That was a good price."')
        wait()

        print('\n\n')
        jump label_577
    fi

label_3973:
    integer(value 2) = integer(value 5)
    integer(value 0) = byte 0
    integer(value 1) = byte 0

label_3994:
    if less(canCarry(character(integer(value 3), byte 0)), weight(data(dword 4411, integer(value 4)), integer(value 2))):
        integer(value 1) = byte 1
        integer(value 0) = byte 1
        integer(value 2) = minus(integer(value 2), byte 1)
        jump label_4094
    fi

    if less(objectsCount(character(integer(value 3), byte 0), byte 88), multiply(integer(value 2), data(dword 4379, integer(value 4)))):
        integer(value 1) = byte 2
        integer(value 2) = minus(integer(value 2), byte 1)
        jump label_4094
    fi

    jump label_4274

label_4094:
    if integer(value 2):
        jump label_3994
    fi

    if equals(integer(value 1), byte 1):
        string(value 0) = data(dword 4427, integer(value 4))
        look(character(integer(value 3), byte 0))
        print('$N looks at $Y. "You haven\'t any room in your pack."')
        wait()

        print('\n\n')
        jump label_577
    fi

    if equals(integer(value 1), byte 2):
        string(value 0) = data(dword 4427, integer(value 4))
        look(character(integer(value 3), byte 0))
        print('"I think you have less gold than you thought."')
        wait()

        print('\n\n')
        jump label_577
    fi

label_4274:
    destroy(character(integer(value 3), byte 0), byte 88, byte 0, multiply(integer(value 2), data(dword 4379, integer(value 4))))
    create(character(integer(value 3), byte 0), data(dword 4411, integer(value 4)), byte 0, integer(value 2))
    look(character(integer(value 3), byte 0))
    string(value 0) = data(dword 4427, integer(value 4))
    print('He hands $Y #2 $0\\s. ')
    printString(dword 4481, integer(value 1))
    wait()

    print('\n\n')
    jump label_577

integers_4379 = [
    5,  // 0
    5,  // 1
    7,  // 2
    15, // 3
    10, // 4
    5,  // 5
    20, // 6
    40, // 7
]

integers_4395 = [
    3,  // 0
    3,  // 1
    5,  // 2
    9,  // 3
    6,  // 4
    3,  // 5
    12, // 6
    24, // 7
]

integers_4411 = [
    90,  // 0
    83,  // 1
    63,  // 2
    77,  // 3
    99,  // 4
    188, // 5
    104, // 6
    223, // 7
]

strings_4427 = [
    'Torch',      // 0
    'Oil',        // 1
    'Lockpick',   // 2
    'Gem',        // 3
    'Backpack',   // 4
    'Bag',        // 5
    'Shovel',     // 6
    'Powder Keg', // 7
]

strings_4481 = [
    '"There you go."',               // 0
    '"That\'s all you can carry."',  // 1
    '"That\'s all you can afford."', // 2
]
