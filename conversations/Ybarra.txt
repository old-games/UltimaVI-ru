source("CONVERSE.B")
index(86)

id(185)
name("Ybarra")

description:
    print("a sunken-faced, starving man, dressed in rags.")

    f3()

interaction:
    wait()

    print("\n")

    if hasBit(byte 235, value 0):
    print("\"Thou art back!\"")
    wait()

    print("\n\n\"Please, please! @Give me some food!\"")
    jump 269

    endif

    print("It takes a few moments for the man to notice you.")
    wait()

    print("\n\n\"Hu--humans!\"")
    wait()

    print("\n\n\"Please, you must help me!\" he says weakly.")
    wait()

    print("\n\n\"I need @food, badly!\"")
    ('SETF', ('byte', 235), ('value', 0))
    print("\n")

    ask()
    case "name":
    print("\"Ybarra. Ybarra's my name.\"")
    jump 269

    case "job":
    print("\"Lost here, no job now.\"")
    wait()

    print("\n\n\"I used to sail under Captain Hawkins on the Empire.\"")
    wait()

    print("\n\n\"We had @food then!\"")
    wait()

    print("\n\n\"But those days are gone....\"")
    jump 269

    case "food":
    print("\"Yes, @food! The last thing I ate was my @belt.\"")
    wait()

    print("\n\n\"And that was three weeks ago.\"")
    wait()

    print("\n\n\"If only you could @give me some food...\"")
    jump 269

    case "belt":
    print("\"Not very tasty, but it was filling.\"")
    jump 269

    case "give":
    case "spar":
    jump 1061

    case "map":
    case "piec":
    print("\"Map? Map. Map.\"")
    wait()

    if equals(hasObject(byte 235, word 404, byte 0), byte 0):
    print("\n\n\"You already got it from me.\"")
    jump 269

    endif

    print("\n\n\"Oh, the map. Yes, I still have that.\"")
    wait()

    print("\n\n\"I couldn't eat it.\"")
    integer(value 9) = byte 0
    wait()

    print("\n\n\"It ought to be worth some @food, surely?\" ")
    jump 1469

    case "join":
    print("\"Leave here? No!\"")
    wait()

    print("\n\"I've almost gotten the tunnels figured out!\"")
    wait()

    print("\n\n\"Just a few more days and I'll be free!\"")
    wait()

    print("\n\n\"But I must have @food!\"")
    jump 269

    case "bye":
    print("\"Don't go! I need @food... @food...\"\n")
    wait()

    jump 1769

    case "*":
    print("\"Huh?\"")
    jump 269

# Unreachable code!
    esac

1061:
    integer(value 0) = byte 0

    if greater(integer(value 0), byte 15):
    jump 1360

    endif

    integer(value 1) = partyHasObject(data(dword 1878, integer(value 0)), byte 0)

    if equals(integer(value 1), word 32769):
    integer(value 0) = plus(integer(value 0), byte 1)
    jump 1068

    endif

    if equals(integer(value 1), byte 1):
    print("You share ")

    else:
    ('SETNAME', ('integer', [('value', 1)]))
    print("$Y shares ")

    endif

    print("some food with the pathetic man.")
    ('DELETE', ('integer', [('value', 1)]), ('data', [('dword', 1878), ('integer', [('value', 0)])]), ('byte', 0), ('objectsCount', [('integer', [('value', 1)]), ('data', [('dword', 1878), ('integer', [('value', 0)])])]))
    ('ADD_KARMA', ('byte', 1))
    wait()

    print("\n\n\"Thunff fou,\" Ybarra says, stuffing the food into his mouth.")
    wait()

    print("\n\nAfter finishing the offered meal, however, Ybarra still seemes ")
    print("starved.")
    jump 269

1360:
    print("Suddenly, you realize that you have no food to give him!")
    wait()

    print("\n\n\"No @food?\" he asks. \"Then thou art doomed too!\"\n")
    bye()

1469:
    askc("yn")
    case "y":
    print("He hands you the map piece and rubs his hands, eagerly awaiting his ")
    print("food.")
    ('GIVE', ('word', 404), ('byte', 0), ('byte', 235), ('byte', 1))
    wait()

    print("\n\n")
    jump 1061

    case "n":

    if equals(integer(value 9), byte 1):
    jump 1661

    endif

    print("\"You must! I'll die! Just a little bit of @food for the map?\" ")
    integer(value 9) = byte 1
    jump 1469

# Unreachable code!
    esac

1661:
    print("His last shred of hope torn away from him, the withered man leaps at ")
    print("you, screaming \"@Food! @Food!\"\n")
    ('WORKTYPE', ('byte', 235), ('byte', 153))
    bye()

1769:
    print("\n\"Can I have a little before you go?\" ")

    askc("yn")
    case "n":
    print("The man collapses, the last of his energy gone.\n")
    ('WORKTYPE', ('byte', 235), ('byte', 145))
    bye()

    case "y":
    jump 1061

# Unreachable code!
    esac

1878:
    ['INTEGERS', [128, 131, 132, 135, 265, 209, 129, 130, 65490, 0, 0, 115, 116, 117, 180, 184]]
