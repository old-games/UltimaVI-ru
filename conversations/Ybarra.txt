source('CONVERSE.B')
index(86)

id(185)
name('Ybarra')

description:
    print('a sunken-faced, starving man, dressed in rags.')

    f3()

interaction:
    wait()

    print('\n')

    if hasBit(byte 235, value 0):
        print('"Thou art back!"')
        wait()

        print('\n\n"Please, please! @Give me some food!"')
        jump label_269
    fi

    print('It takes a few moments for the man to notice you.')
    wait()

    print('\n\n"Hu--humans!"')
    wait()

    print('\n\n"Please, you must help me!" he says weakly.')
    wait()

    print('\n\n"I need @food, badly!"')
    setBit(byte 235, value 0)

label_269:
    print('\n')

    ask()

    case 'name':
        print('"Ybarra. Ybarra\'s my name."')
        jump label_269

    case 'job':
        print('"Lost here, no job now."')
        wait()

        print('\n\n"I used to sail under Captain Hawkins on the Empire."')
        wait()

        print('\n\n"We had @food then!"')
        wait()

        print('\n\n"But those days are gone...."')
        jump label_269

    case 'food':
        print('"Yes, @food! The last thing I ate was my @belt."')
        wait()

        print('\n\n"And that was three weeks ago."')
        wait()

        print('\n\n"If only you could @give me some food..."')
        jump label_269

    case 'belt':
        print('"Not very tasty, but it was filling."')
        jump label_269

    case 'give':
    case 'spar':
        jump label_1061

    case 'map':
    case 'piec':
        print('"Map? Map. Map."')
        wait()

        if equals(hasObject(byte 235, word 404, byte 0), byte 0):
            print('\n\n"You already got it from me."')
            jump label_269
        fi

        print('\n\n"Oh, the map. Yes, I still have that."')
        wait()

        print('\n\n"I couldn\'t eat it."')
        integer(value 9) = byte 0
        wait()

        print('\n\n"It ought to be worth some @food, surely?" ')
        jump label_1469

    case 'join':
        print('"Leave here? No!"')
        wait()

        print('\n"I\'ve almost gotten the tunnels figured out!"')
        wait()

        print('\n\n"Just a few more days and I\'ll be free!"')
        wait()

        print('\n\n"But I must have @food!"')
        jump label_269

    case 'bye':
        print('"Don\'t go! I need @food... @food..."\n')
        wait()

        jump label_1769

    case '*':
        print('"Huh?"')
        jump label_269
    esac

label_1061:
    integer(value 0) = byte 0

label_1068:
    if greater(integer(value 0), byte 15):
        jump label_1360
    fi

    integer(value 1) = partyHasObject(data(integers_1878, integer(value 0)), byte 0)

    if equals(integer(value 1), word 32769):
        integer(value 0) = plus(integer(value 0), byte 1)
        jump label_1068
    fi

    if equals(integer(value 1), byte 1):
        print('You share ')

    else:
        look(integer(value 1))
        print('$Y shares ')
    fi

    print('some food with the pathetic man.')
    destroyItem(integer(value 1), data(integers_1878, integer(value 0)), byte 0, objectsCount(integer(value 1), data(integers_1878, integer(value 0))))
    increaseKarma(byte 1)
    wait()

    print('\n\n"Thunff fou," Ybarra says, stuffing the food into his mouth.')
    wait()

    print('\n\nAfter finishing the offered meal, however, Ybarra still seemes ')
    print('starved.')
    jump label_269

label_1360:
    print('Suddenly, you realize that you have no food to give him!')
    wait()

    print('\n\n"No @food?" he asks. "Then thou art doomed too!"\n')
    bye()

label_1469:
    choice('yn')

    case 'y':
        print('He hands you the map piece and rubs his hands, eagerly awaiting his ')
        print('food.')
        giveItem(word 404, byte 0, byte 235, byte 1)
        wait()

        print('\n\n')
        jump label_1061

    case 'n':
        if equals(integer(value 9), byte 1):
            jump label_1661
        fi

        print('"You must! I\'ll die! Just a little bit of @food for the map?" ')
        integer(value 9) = byte 1
        jump label_1469
    esac

label_1661:
    print('His last shred of hope torn away from him, the withered man leaps at ')
    print('you, screaming "@Food! @Food!"\n')
    do(byte 235, byte 153)
    bye()

label_1769:
    print('\n"Can I have a little before you go?" ')

    choice('yn')

    case 'n':
        print('The man collapses, the last of his energy gone.\n')
        do(byte 235, byte 145)
        bye()

    case 'y':
        jump label_1061
    esac

integers_1878 = [
    128,   // 0
    131,   // 1
    132,   // 2
    135,   // 3
    265,   // 4
    209,   // 5
    129,   // 6
    130,   // 7
    65490, // 8
    0,     // 9
    0,     // 10
    115,   // 11
    116,   // 12
    117,   // 13
    180,   // 14
    184,   // 15
]
