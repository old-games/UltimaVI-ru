source('CONVERSE.A')
index(28)

id(28)
name('Arty')

description:
    print('a silent but good-natured man.')
    wait()

    print('\n')

interaction:
    integer(value 5) = byte 0

    if equals(integer(value 32), byte 138):
        print('He looks up from his tankard of ale, sees you and smiles.')

    else:
        print('He grins widely and waves at you.')
        ('SETF', ('byte', 235), ('value', 0))
    fi

label_152:
    print('\n')

    ask()

    case 'name':
        print('He points to his mouth and shakes his head.')

        if integer(value 23):
            integer(value 0) = character(byte 1, byte 0)
            ('SETNAME', ('integer', [('value', 0)]))
            wait()

            ('PORTRAIT', ('integer', [('value', 0)]))
            print('\n\n$Y speaks. "I know of this person, $G."')
            wait()

            print('\n\n"He is Arty the Mute, a local shipwright and an honored citizen."')
            wait()

            ('PORTRAIT', ('byte', 235))
            print('\n\nThe man smiles and nods.')
        fi

        jump label_152

    case 'mute':
        print('Arty smiles and nods.')
        jump label_152

    case 'deaf':
        print('The man shakes his head.')
        jump label_152

    case 'buy':
        if notEquals(integer(value 32), byte 146):
            print('The man looks at you, puzzled.')
            jump label_152
        fi

        if equals(hasObject(byte 235, byte 149, byte 0), byte 0):
            print('The man shakes his head and spreads his hands as if to say "sorry."')
            jump label_152
        fi

        print('The man smiles and points to ')

        if or(hasObject(byte 235, byte 149, data(dword 2459, byte 0)), hasObject(byte 235, byte 149, data(dword 2459, byte 1))):
            print('the deed to a @ship')
            integer(value 1) = byte 1

        else:
            integer(value 1) = byte 0
        fi

        if equals(or(hasObject(byte 235, byte 149, data(dword 2459, byte 2)), hasObject(byte 235, byte 149, data(dword 2459, byte 3))), byte 0):
            print('.')
            jump label_152
        fi

        if integer(value 1):
            print(' and to a ')

        else:
            print('the deed to a ')
        fi

        print('@skiff.')
        jump label_152

    case 'ship':
        if notEquals(integer(value 32), byte 146):
            print('The man looks at you, puzzled.')
            jump label_152
        fi

        if hasObject(byte 235, byte 149, data(dword 2459, byte 0)):
            integer(value 9) = byte 0
            jump label_1572
        fi

        if hasObject(byte 235, byte 149, data(dword 2459, byte 1)):
            integer(value 9) = byte 1
            jump label_1572
        fi

        print('The man shakes his head and spreads his hands as if to say "sorry."')
        jump label_152

    case 'skif':
        if notEquals(integer(value 32), byte 146):
            print('The man looks at you, puzzled.')
            jump label_152
        fi

        if hasObject(byte 235, byte 149, data(dword 2459, byte 2)):
            integer(value 9) = byte 2
            jump label_1572
        fi

        if hasObject(byte 235, byte 149, data(dword 2459, byte 3)):
            integer(value 9) = byte 3
            jump label_1572
        fi

        print('The man shakes his head and spreads his hands as if to say "sorry."')
        jump label_152

    case 'job':
        if equals(integer(value 32), byte 138):
            print('The man looks at you, puzzled.*\n\nThen he raises his tankard and goes ')
            print('back to drinking.')
            jump label_152
        fi

        if equals(integer(value 32), byte 146):
            print('He smiles and points to the workbench.')
            wait()

            print('\n\nOn the bench, you see the tools of a shipwright.')
            jump label_152
        fi

        jump label_1467

    case 'bye':
        print('Arty waves as you leave, then returns to ')

        if equals(integer(value 32), byte 138):
            print('his ale.\n')

        else:
            print('what he was doing.\n')
        fi

        bye()

    case '*':
        if equals(integer(value 32), byte 138):
            print('The man just shrugs and takes another swig from his mug.')
            jump label_152
        fi

label_1467:
        if random(byte 0, byte 1):
            print('The man seems frustrated, as if there were something he wanted to say.')

        else:
            print('The man just shrugs.')
        fi

        jump label_152
    esac

label_1572:
    integer(value 5) = byte 0

    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 0
        jump label_1714
    fi

label_1599:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_1613:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#2) $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_1613
    fi

    print('Who is buying? ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump label_2034
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_1599
    fi

label_1714:
    integer(value 3) = character(integer(value 3), byte 0)
    integer(value 4) = data(dword 2451, integer(value 9))
    ('SETNAME', ('integer', [('value', 3)]))
    print('$N shows $Y a deed. Written on it is the price, #4 gold.')
    wait()

    print('\n\nDoes $Y want to buy the deed? ')

    choice('yn')

    case 'y':
        if less(plus(canCarry(integer(value 3)), weight(byte 88, data(dword 2451, integer(value 9)))), weight(byte 149, byte 1)):
            print('$Y cannot carry that.')
            jump label_152
        fi

        if less(objectsCount(integer(value 3), byte 88), data(dword 2451, integer(value 9))):
            jump label_2072

        else:
            ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('data', [('dword', 2451), ('integer', [('value', 9)])]))
            jump label_1942
        fi

    case 'n':
        jump label_2034
    esac

label_1942:
    ('GIVE', ('byte', 149), ('data', [('dword', 2459), ('integer', [('value', 9)])]), ('byte', 235), ('integer', [('value', 3)]))
    print('After accepting the gold, $N smiles and hands $Y the deed.')
    integer(value 5) = byte 1
    wait()

    print('\n\n')
    jump label_2034

label_2034:
    if integer(value 5):
        print('$N seems pleased.')

    else:
        print('$N shrugs.')
    fi

    jump label_152

label_2072:
    if equals(integer(value 23), byte 0):
        print('You don\'t have enough gold for that.')
        jump label_152
    fi

    integer(value 1) = data(dword 2451, integer(value 9))
    integer(value 2) = byte 0
    integer(value 6) = byte 0
    integer(value 4) = byte 0

label_2155:
    if greater(integer(value 6), integer(value 23)):
        print('Your party doesn\'t have enough gold for that.')
        jump label_152
    fi

    integer(value 5) = objectsCount(character(integer(value 6), byte 0), byte 88)

    if less(integer(value 5), integer(value 1)):
        integer(value 1) = minus(integer(value 1), integer(value 5))
        integer(value 2) = plus(integer(value 2), integer(value 5))
        integer(value 6) = plus(integer(value 6), byte 1)
        jump label_2155

    else:
        print('Your party takes up a collection to purchase the vessel.')
        integer(value 1) = data(dword 2451, integer(value 9))
        integer(value 2) = byte 0
        integer(value 4) = integer(value 6)
        integer(value 6) = byte 0
        jump label_2365
    fi

label_2365:
    if equals(integer(value 6), integer(value 4)):
        ('DELETE', ('character', [('integer', [('value', 6)]), ('byte', 0)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
        wait()

        print('\n\n')
        jump label_1942
    fi

    integer(value 5) = objectsCount(character(integer(value 6), byte 0), byte 88)
    integer(value 1) = minus(integer(value 1), integer(value 5))
    ('DELETE', ('character', [('integer', [('value', 6)]), ('byte', 0)]), ('byte', 88), ('byte', 0), ('integer', [('value', 5)]))
    integer(value 6) = plus(integer(value 6), byte 1)
    jump label_2365

integers_2451 = [
    300, // 0
    300, // 1
    40,  // 2
    40,  // 3
]

integers_2459 = [
    7,   // 0
    8,   // 1
    134, // 2
    135, // 3
]
