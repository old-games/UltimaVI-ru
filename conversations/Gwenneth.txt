source("CONVERSE.A")
index(16)

id(16)
name("Gwenneth")

description:
    print("a petite woman with flowing brown hair.")
    wait()

interaction:
    integer(value 8) = byte 4
    print("\n")

    if hasBit(byte 235, value 0):
    jump 612

    endif

    ('SETF', ('byte', 235), ('value', 0))

    if partyHas(byte 4):
    print("\"Iolo!")

    else:
    jump 519

    endif

    if integer(value 23):
    print(" And thy companions as well!\"")

    else:
    print("\"")

    endif

    wait()

    print("\n\n\"I heard rumors that you were in town!\"")
    wait()

    ('PORTRAIT', ('byte', 4))
    print("\n\nIolo greets his former apprentice warmly.")
    wait()

    print("\n\n\"How goes business, Gwenneth?\"")
    wait()

    ('PORTRAIT', ('byte', 235))
    print("\n\n\"Very well, very well indeed. Sir Geoffrey himself just placed quite")
    print(" a large order!\"")
    wait()

    print("\n\n\"Much demand for bows these days, what with the @gargoyles!\"")

    if integer(value 23):
    wait()

    print("\n\nTurning to you, Gwenneth says, \"And what can I do for Iolo's friend")

    else:
    jump 690

    endif

    if greater(integer(value 23), byte 1):
    print("s")

    endif

    print(" this fine $T?\"")
    jump 690

519:
    print("\"I recongize thee! Thou art Iolo's friend, $P!\"")
    wait()

    print("\n\n\"What can I do for thee this fine $T?\"")
    jump 690

612:
    print("\"Hello again. What can I do for thee this fine $T?\"")
    jump 690

668:
    print("\n\"What'll it be next?\"\n")

690:
    print("\n")

    ask()
    case "buy":
    jump 3916

    case "sell":
    jump 2994

    case "name":

    if partyHas(byte 4):
    print("\"What a strange question. I'm Gwenneth, of course.\"")
    wait()

    print("\n\n\"Just ask Iolo!\"")

    else:
    print("\"But dost thou not know Iolo?\"")
    wait()

    print("\n\n\"Well, I am his former aprrentice, Gwenneth.\"")

    endif

    jump 690

    case "job":
    print("\"Once was I Iolo's apprentice, but then he decided to retire.\"")
    wait()

    print("\n\n\"Now 'tis my shop, and I craft the bows sold here!\"")
    wait()

    print("\n\n\\\"'Course, 'tis still called @Iolo's Bows, out of respect for the ")
    print("master.\"")

    if partyHas(byte 4):
    wait()

    print("\n\nAt this, Iolo blushes humbly.")
    jump 690

    else:
    jump 690

    endif

    case "garg":
    print("\"I hear from the soldiers that the gargoyles are fierce opponents.\"")
    wait()

    print("\n\n\"Some gargoyles move like the wind itself, and can strike you like ")
    print("lightning bolts!\"")
    wait()

    print("\n\n\"The gargoyles also have a strange and terrible @weapon.\"")
    jump 690

    case "weap":
    print("\"'Tis called a boomerang, and it is a most bizarre ranged weapon.\"")
    wait()

    print("\n\n\"It flies out to strike its target, then returns to the hand that ")
    print("threw it!\"")
    wait()

    print("\n\n\"Against such magic the soldiers chose to arm themselves with good, ")
    print("stout Britannian bows!\"")
    jump 690

    case "iolo":

    if partyHas(byte 4):
    print("She smiles. \"I would not wish to speak of Iolo amongst his friends.\"")
    wait()

    print("\n\n\"I might embarass him!\"")

    else:
    print("\"Nay, I really would not wish to speak of my master behind his back.\"")

    endif

    jump 690

    case "arro,bolt":
    print("\"Aye, usually do I carry those in stock.\"")
    wait()

    print("\n\n\"But there has been a shortage of late, because of the @gargoyle ")
    print("war.\"")
    wait()

    print("\n\n\"Go see Lynn the Fletcher, over to the north.\"")
    jump 690

    case "lynn":
    print("\"Lynn is a fine fletcher, and usually keeps me supplied with @arrows ")
    print("and @bolts.\"")
    wait()

    print("\n\n\"I've none left in stock, though, since the soldiers bought them ")
    print("all.\"")
    jump 690

    case "trip":

    if hasBit(byte 235, byte 2):
    print("\"I fear I had but one triple crossbow for sale.\"")
    wait()

    print("\n\n\"Come back in six months and I may have another.\"")
    jump 690

    else:
    jump 2409

    endif

    case "bye":

    if integer(value 23):
    print("\"Farewell, all of you.\"")

    else:
    print("\"Farewell to thee!\"")

    endif

    if partyHas(byte 4):
    wait()

    print("\n\n\"Iolo, I'll see thee again soon with thy share of this month's ")
    print("profits!\"")

    endif

    print("\n")
    bye()

    case "*":
    print("\"Beg pardon?\"")

    esac

    jump 690

2409:
    print("\"Ah, I see thou art a discerning buyer.\"")
    wait()

    print("\n\n\"The triple-crossbow is a marvel to behold.\"")
    wait()

    print("\n\n\"This enchanted weapon fires three bolts at once!\"")
    wait()

    print("\n\n\"Normally, I would not offer it for sale.\"")
    wait()

    print("\n\n\"But, because thy cause is important, I will allow thee--and thee ")
    print("only!--to buy it.\"")
    wait()

    print("\n\n\"But I fear I must charge 400 gold for it.\"")
    wait()

    print("\n\n\"Dost thou wish to buy this weapon?\" ")

    askc("yn")
    case "y":

    if less(plus(canCarry(character(byte 0, byte 0)), weight(byte 88, word 400)), weight(byte 50, byte 0)):
    print("\"But thou cannot carry it!\"")
    jump 690

    endif

    if less(objectsCount(character(byte 0, byte 0), byte 88), word 400):
    print("\"But thou cannot afford it!\"")
    jump 690

    endif

    ('DELETE', ('character', [('byte', 0), ('byte', 0)]), ('byte', 88), ('byte', 0), ('word', 400))
    ('NEW', ('character', [('byte', 0), ('byte', 0)]), ('byte', 50), ('byte', 0), ('byte', 1))
    ('SETF', ('byte', 235), ('byte', 2))
    jump 690

    esac

    case "n":
    print("\"It will be here, waiting for thee, if thou hast a need for it.\"")
    jump 690

2994:
    integer(value 0) = byte 0
    integer(value 2) = byte 0
    integer(value 3) = byte 0
    integer(value 1) = byte 0

    if hasObject(character(integer(value 0), byte 0), data(dword 4801, integer(value 1)), byte 0):
    data(dword 4870, integer(value 2)) = integer(value 0)
    integer(value 2) = plus(integer(value 2), byte 1)
    integer(value 3) = byte 1
    jump 3102

    endif

    integer(value 1) = plus(integer(value 1), byte 1)

    if data(dword 4801, integer(value 1)):
    jump 3022

    endif

    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
    jump 3015

    endif

    if equals(integer(value 3), byte 0):
    print("\"Sorry, none of you has anything I need.\"")
    wait()

    print("\n")
    jump 668

    endif

    if equals(integer(value 2), byte 1):
    integer(value 3) = character(data(dword 4870, byte 0), byte 0)
    ('SETNAME', ('integer', [('value', 3)]))
    print("\"Aye, $Y has something of interest...\"")
    wait()

    print("\n\n")
    jump 3379

    endif

    integer(value 1) = byte 1
    ('SETNAME', ('character', [('data', [('dword', 4870), ('minus', [('integer', [('value', 1)]), ('byte', 1)])]), ('byte', 0)]))
    print("#1) $Y\n")
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 2)):
    jump 3262

    endif

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
    jump 3885

    endif

    integer(value 3) = minus(integer(value 3), byte 1)

    if greaterOrEquals(integer(value 3), integer(value 2)):
    jump 3255

    endif

    integer(value 3) = character(data(dword 4870, integer(value 3)), byte 0)
    integer(value 0) = byte 0
    integer(value 5) = byte 0

    if equals(hasObject(integer(value 3), data(dword 4801, integer(value 0)), byte 0), byte 0):
    jump 3440

    endif

    data(dword 4840, integer(value 5)) = integer(value 0)
    integer(value 5) = plus(integer(value 5), byte 1)
    integer(value 0) = plus(integer(value 0), byte 1)

    if data(dword 4801, integer(value 0)):
    jump 3393

    endif

    if equals(integer(value 5), byte 1):
    integer(value 6) = data(dword 4840, byte 0)
    jump 3604

    endif

    integer(value 0) = byte 1
    print("#0) ")
    ('DPRINT', [('data', [('dword', 4840), ('minus', [('integer', [('value', 0)]), ('byte', 1)])]), ('dword', 4811)])
    print("\n")
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 5)):
    jump 3499

    endif

    print("\"Which item?\" ")
    ('INPUTNUM', 6)

    if greater(integer(value 6), integer(value 5)):
    jump 3379

    endif

    if equals(integer(value 6), byte 0):
    jump 3885

    endif

    integer(value 6) = data(dword 4840, minus(integer(value 6), byte 1))
    string(value 0) = data(dword 4811, integer(value 6))
    integer(value 7) = divide(data(dword 4793, integer(value 6)), byte 2)
    ('SETNAME', ('integer', [('value', 3)]))
    print("\"Will you take #7 gold for that $0, $Y?\" ")

    askc("yn")
    case "n":

    if equals(integer(value 5), byte 1):
    print("\"Perhaps some other time, then.\"")
    wait()

    print("\n")
    jump 668

    else:
    print("\"Perhaps something else then?\"")
    wait()

    print("\n\n")
    jump 3379

    endif

    case "y":
    ('SETNAME', ('integer', [('value', 3)]))
    print("\"Done!\" $N hands $Y #7 gold pieces and takes the $0.")
    ('DELETE', ('integer', [('value', 3)]), ('data', [('dword', 4801), ('integer', [('value', 6)])]), ('byte', 0), ('byte', 1))
    ('NEW', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 7)]))

    if equals(integer(value 5), byte 1):
    print("\n")
    jump 668

    else:
    wait()

    print("\n\n")
    jump 3379

    endif

3885:
    print("\"Changed your mind, eh?\"")
    wait()

    print("\n")
    jump 668

3916:
    if equals(integer(value 23), byte 0):
    integer(value 3) = byte 1
    jump 4062

    endif

    integer(value 0) = byte 0
    integer(value 2) = byte 1
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print("#2) $Y\n")
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
    jump 3950

    endif

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
    jump 3885

    endif

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
    jump 3936

    endif

    integer(value 3) = character(integer(value 3), byte 0)
    integer(value 0) = byte 1
    ('SETNAME', ('integer', [('value', 3)]))
    string(value 0) = data(dword 4811, minus(integer(value 0), byte 1))
    print("#0) $0\n")
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 8)):
    jump 4073

    endif

    integer(value 7) = integer(value 0)
    print("\"Which item?\" ")
    ('INPUTNUM', 0)

    if equals(integer(value 0), byte 0):
    jump 3885

    endif

    if greaterOrEquals(integer(value 0), integer(value 7)):
    jump 4062

    endif

    integer(value 0) = minus(integer(value 0), byte 1)
    integer(value 1) = data(dword 4793, integer(value 0))
    string(value 1) = data(dword 4811, integer(value 0))
    print("\"That $1 costs #1 gold.\"")
    wait()

    print("\n\n\"Interested, $Y?\" ")

    askc("yn")
    case "y":
    jump 4270

    case "n":
    jump 4062

4270:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(dword 4801, integer(value 0)), byte 1)):
    print("\"But 'twould make thee o'erburdened, $Y!\"")
    wait()

    print("\n")
    jump 668

    endif

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
    ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
    ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 4801), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 1))
    print("\"Excellent!\"\n\nAfter accepting $Y's gold, $N hands over the $1.")
    wait()

    print("\n\n")
    jump 4062

    else:
    jump 4461

    endif

4461:
    if equals(partyHas(byte 4), byte 0):
    print("\"But thou hast not enough gold, $Y!\"")
    wait()

    print("\n")
    jump 668

    endif

    if equals(hasBit(byte 235, byte 3), byte 0):
    print("\"Thou hast not enough gold, $Y.\"")
    wait()

    print("\n\nShe winks at Iolo. \"But I think I can trust thee with credit, just ")
    print("this once!\"")
    ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 4801), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 1))
    ('SETF', ('byte', 235), ('byte', 3))
    wait()

    print("\n")
    jump 668

    else:
    print("\"I'm sorry, $Y, but I cannot offer more credit, even to thee.\"")
    wait()

    print("\n\n\"The @gargoyle wars make my wares much in demand!\"")
    wait()

    print("\n")
    jump 668

    endif

4793:
    ['INTEGERS', [30, 40, 10, 300]]

4801:
    ['INTEGERS', [41, 42, 33, 54, 0]]

4811:
    ['STRINGS', ['Bow', 'Crossbow', 'Sling', 'Magic Bow']]

4840:
    ['INTEGERS', [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]

4870:
    ['INTEGERS', [0, 0, 0, 0, 0, 0, 0, 0]]
