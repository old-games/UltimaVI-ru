source('CONVERSE.A')
index(16)

id(16)
name('Gwenneth')

description:
    print('a petite woman with flowing brown hair.')
    wait()

interaction:
    integer(value 8) = byte 4
    print('\n')

    if hasBit(byte 235, value 0):
        jump label_612
    fi

    setBit(byte 235, value 0)

    if partyHas(byte 4):
        print('"Iolo!')

    else:
        jump label_519
    fi

    if integer(value 23):
        print(' And thy companions as well!"')

    else:
        print('"')
    fi

    wait()

    print('\n\n"I heard rumors that you were in town!"')
    wait()

    portrait(byte 4)
    print('\n\nIolo greets his former apprentice warmly.')
    wait()

    print('\n\n"How goes business, Gwenneth?"')
    wait()

    portrait(byte 235)
    print('\n\n"Very well, very well indeed. Sir Geoffrey himself just placed quite')
    print(' a large order!"')
    wait()

    print('\n\n"Much demand for bows these days, what with the @gargoyles!"')

    if integer(value 23):
        wait()

        print('\n\nTurning to you, Gwenneth says, "And what can I do for Iolo\'s friend')

    else:
        jump label_690
    fi

    if greater(integer(value 23), byte 1):
        print('s')
    fi

    print(' this fine $T?"')
    jump label_690

label_519:
    print('"I recongize thee! Thou art Iolo\'s friend, $P!"')
    wait()

    print('\n\n"What can I do for thee this fine $T?"')
    jump label_690

label_612:
    print('"Hello again. What can I do for thee this fine $T?"')
    jump label_690

label_668:
    print('\n"What\'ll it be next?"')

label_690:
    print('\n')

    ask()

    case 'buy':
        jump label_3916

    case 'sell':
        jump label_2994

    case 'name':
        if partyHas(byte 4):
            print('"What a strange question. I\'m Gwenneth, of course."')
            wait()

            print('\n\n"Just ask Iolo!"')

        else:
            print('"But dost thou not know Iolo?"')
            wait()

            print('\n\n"Well, I am his former aprrentice, Gwenneth."')
        fi

        jump label_690

    case 'job':
        print('"Once was I Iolo\'s apprentice, but then he decided to retire."')
        wait()

        print('\n\n"Now \'tis my shop, and I craft the bows sold here!"')
        wait()

        print('\n\n\\"\'Course, \'tis still called @Iolo\'s Bows, out of respect for the ')
        print('master."')

        if partyHas(byte 4):
            wait()

            print('\n\nAt this, Iolo blushes humbly.')
            jump label_690

        else:
            jump label_690
        fi

    case 'garg':
        print('"I hear from the soldiers that the gargoyles are fierce opponents."')
        wait()

        print('\n\n"Some gargoyles move like the wind itself, and can strike you like ')
        print('lightning bolts!"')
        wait()

        print('\n\n"The gargoyles also have a strange and terrible @weapon."')
        jump label_690

    case 'weap':
        print('"\'Tis called a boomerang, and it is a most bizarre ranged weapon."')
        wait()

        print('\n\n"It flies out to strike its target, then returns to the hand that ')
        print('threw it!"')
        wait()

        print('\n\n"Against such magic the soldiers chose to arm themselves with good, ')
        print('stout Britannian bows!"')
        jump label_690

    case 'iolo':
        if partyHas(byte 4):
            print('She smiles. "I would not wish to speak of Iolo amongst his friends."')
            wait()

            print('\n\n"I might embarass him!"')

        else:
            print('"Nay, I really would not wish to speak of my master behind his back."')
        fi

        jump label_690

    case 'arro':
    case 'bolt':
        print('"Aye, usually do I carry those in stock."')
        wait()

        print('\n\n"But there has been a shortage of late, because of the @gargoyle ')
        print('war."')
        wait()

        print('\n\n"Go see Lynn the Fletcher, over to the north."')
        jump label_690

    case 'lynn':
        print('"Lynn is a fine fletcher, and usually keeps me supplied with @arrows ')
        print('and @bolts."')
        wait()

        print('\n\n"I\'ve none left in stock, though, since the soldiers bought them ')
        print('all."')
        jump label_690

    case 'trip':
        if hasBit(byte 235, byte 2):
            print('"I fear I had but one triple crossbow for sale."')
            wait()

            print('\n\n"Come back in six months and I may have another."')
            jump label_690

        else:
            jump label_2409
        fi

    case 'bye':
        if integer(value 23):
            print('"Farewell, all of you."')

        else:
            print('"Farewell to thee!"')
        fi

        if partyHas(byte 4):
            wait()

            print('\n\n"Iolo, I\'ll see thee again soon with thy share of this month\'s ')
            print('profits!"')
        fi

        print('\n')
        bye()

    case '*':
        print('"Beg pardon?"')
    esac

    jump label_690

label_2409:
    print('"Ah, I see thou art a discerning buyer."')
    wait()

    print('\n\n"The triple-crossbow is a marvel to behold."')
    wait()

    print('\n\n"This enchanted weapon fires three bolts at once!"')
    wait()

    print('\n\n"Normally, I would not offer it for sale."')
    wait()

    print('\n\n"But, because thy cause is important, I will allow thee--and thee ')
    print('only!--to buy it."')
    wait()

    print('\n\n"But I fear I must charge 400 gold for it."')
    wait()

    print('\n\n"Dost thou wish to buy this weapon?" ')

    choice('yn')

    case 'y':
        if less(plus(canCarry(character(byte 0, byte 0)), weight(byte 88, word 400)), weight(byte 50, byte 0)):
            print('"But thou cannot carry it!"')
            jump label_690
        fi

        if less(objectsCount(character(byte 0, byte 0), byte 88), word 400):
            print('"But thou cannot afford it!"')
            jump label_690
        fi

        destroyItem(character(byte 0, byte 0), byte 88, byte 0, word 400)
        createItem(character(byte 0, byte 0), byte 50, byte 0, byte 1)
        setBit(byte 235, byte 2)
        jump label_690
    esac

    case 'n':
        print('"It will be here, waiting for thee, if thou hast a need for it."')
        jump label_690
    esac

label_2994:
    integer(value 0) = byte 0
    integer(value 2) = byte 0
    integer(value 3) = byte 0

label_3015:
    integer(value 1) = byte 0

label_3022:
    if hasObject(character(integer(value 0), byte 0), data(integers_4801, integer(value 1)), byte 0):
        data(integers_4870, integer(value 2)) = integer(value 0)
        integer(value 2) = plus(integer(value 2), byte 1)
        integer(value 3) = byte 1
        jump label_3102
    fi

    integer(value 1) = plus(integer(value 1), byte 1)

    if data(integers_4801, integer(value 1)):
        jump label_3022
    fi

label_3102:
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_3015
    fi

    if equals(integer(value 3), byte 0):
        print('"Sorry, none of you has anything I need."')
        wait()

        print('\n')
        jump label_668
    fi

    if equals(integer(value 2), byte 1):
        integer(value 3) = character(data(integers_4870, byte 0), byte 0)
        look(integer(value 3))
        print('"Aye, $Y has something of interest..."')
        wait()

        print('\n\n')
        jump label_3379
    fi

label_3255:
    integer(value 1) = byte 1

label_3262:
    look(character(data(integers_4870, minus(integer(value 1), byte 1)), byte 0))
    print('#1) $Y\n')
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 2)):
        jump label_3262
    fi

    print('"Which of you?" ')
    inputInteger(integer(value 3))

    if equals(integer(value 3), byte 0):
        jump label_3885
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greaterOrEquals(integer(value 3), integer(value 2)):
        jump label_3255
    fi

    integer(value 3) = character(data(integers_4870, integer(value 3)), byte 0)

label_3379:
    integer(value 0) = byte 0
    integer(value 5) = byte 0

label_3393:
    if equals(hasObject(integer(value 3), data(integers_4801, integer(value 0)), byte 0), byte 0):
        jump label_3440
    fi

    data(integers_4840, integer(value 5)) = integer(value 0)
    integer(value 5) = plus(integer(value 5), byte 1)

label_3440:
    integer(value 0) = plus(integer(value 0), byte 1)

    if data(integers_4801, integer(value 0)):
        jump label_3393
    fi

    if equals(integer(value 5), byte 1):
        integer(value 6) = data(integers_4840, byte 0)
        jump label_3604
    fi

    integer(value 0) = byte 1

label_3499:
    print('#0) ')
    printString(strings_4811, data(integers_4840, minus(integer(value 0), byte 1)))
    print('\n')
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 5)):
        jump label_3499
    fi

    print('"Which item?" ')
    inputInteger(integer(value 6))

    if greater(integer(value 6), integer(value 5)):
        jump label_3379
    fi

    if equals(integer(value 6), byte 0):
        jump label_3885
    fi

    integer(value 6) = data(integers_4840, minus(integer(value 6), byte 1))

label_3604:
    string(value 0) = data(strings_4811, integer(value 6))
    integer(value 7) = divide(data(integers_4793, integer(value 6)), byte 2)
    look(integer(value 3))
    print('"Will you take #7 gold for that $0, $Y?" ')

    choice('yn')

    case 'n':
        if equals(integer(value 5), byte 1):
            print('"Perhaps some other time, then."')
            wait()

            print('\n')
            jump label_668

        else:
            print('"Perhaps something else then?"')
            wait()

            print('\n\n')
            jump label_3379
        fi

    case 'y':
        look(integer(value 3))
        print('"Done!" $N hands $Y #7 gold pieces and takes the $0.')
        destroyItem(integer(value 3), data(integers_4801, integer(value 6)), byte 0, byte 1)
        createItem(integer(value 3), byte 88, byte 0, integer(value 7))

        if equals(integer(value 5), byte 1):
            print('\n')
            jump label_668

        else:
            wait()

            print('\n\n')
            jump label_3379
        fi
    esac

label_3885:
    print('"Changed your mind, eh?"')
    wait()

    print('\n')
    jump label_668

label_3916:
    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 1
        jump label_4062
    fi

label_3936:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_3950:
    look(character(integer(value 0), byte 0))
    print('#2) $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_3950
    fi

    print('"Which of you?" ')
    inputInteger(integer(value 3))

    if equals(integer(value 3), byte 0):
        jump label_3885
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_3936
    fi

    integer(value 3) = character(integer(value 3), byte 0)

label_4062:
    integer(value 0) = byte 1
    look(integer(value 3))

label_4073:
    string(value 0) = data(strings_4811, minus(integer(value 0), byte 1))
    print('#0) $0\n')
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 8)):
        jump label_4073
    fi

    integer(value 7) = integer(value 0)
    print('"Which item?" ')
    inputInteger(integer(value 0))

    if equals(integer(value 0), byte 0):
        jump label_3885
    fi

    if greaterOrEquals(integer(value 0), integer(value 7)):
        jump label_4062
    fi

    integer(value 0) = minus(integer(value 0), byte 1)
    integer(value 1) = data(integers_4793, integer(value 0))
    string(value 1) = data(strings_4811, integer(value 0))
    print('"That $1 costs #1 gold."')
    wait()

    print('\n\n"Interested, $Y?" ')

    choice('yn')

    case 'y':
        jump label_4270

    case 'n':
        jump label_4062
    esac

label_4270:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(integers_4801, integer(value 0)), byte 1)):
        print('"But \'twould make thee o\'erburdened, $Y!"')
        wait()

        print('\n')
        jump label_668
    fi

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
        destroyItem(integer(value 3), byte 88, byte 0, integer(value 1))
        createItem(integer(value 3), data(integers_4801, integer(value 0)), byte 0, byte 1)
        print('"Excellent!"\n\nAfter accepting $Y\'s gold, $N hands over the $1.')
        wait()

        print('\n\n')
        jump label_4062

    else:
        jump label_4461
    fi

label_4461:
    if equals(partyHas(byte 4), byte 0):
        print('"But thou hast not enough gold, $Y!"')
        wait()

        print('\n')
        jump label_668
    fi

    if equals(hasBit(byte 235, byte 3), byte 0):
        print('"Thou hast not enough gold, $Y."')
        wait()

        print('\n\nShe winks at Iolo. "But I think I can trust thee with credit, just ')
        print('this once!"')
        createItem(integer(value 3), data(integers_4801, integer(value 0)), byte 0, byte 1)
        setBit(byte 235, byte 3)
        wait()

        print('\n')
        jump label_668

    else:
        print('"I\'m sorry, $Y, but I cannot offer more credit, even to thee."')
        wait()

        print('\n\n"The @gargoyle wars make my wares much in demand!"')
        wait()

        print('\n')
        jump label_668
    fi

integers_4793 = [
    30,  // 0
    40,  // 1
    10,  // 2
    300, // 3
]

integers_4801 = [
    41, // 0
    42, // 1
    33, // 2
    54, // 3
    0,  // 4
]

strings_4811 = [
    'Bow',       // 0
    'Crossbow',  // 1
    'Sling',     // 2
    'Magic Bow', // 3
]

integers_4840 = [
    0, // 0
    0, // 1
    0, // 2
    0, // 3
    0, // 4
    0, // 5
    0, // 6
    0, // 7
    0, // 8
    0, // 9
    0, // 10
    0, // 11
    0, // 12
    0, // 13
    0, // 14
]

integers_4870 = [
    0, // 0
    0, // 1
    0, // 2
    0, // 3
    0, // 4
    0, // 5
    0, // 6
    0, // 7
]
