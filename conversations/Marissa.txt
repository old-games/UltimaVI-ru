source('CONVERSE.B')
index(3)

id(102)
name('Marissa')

description:
    print('a finely adorned woman with a tight mouth and wide eyes.')
    wait()

    print('\n')

interaction:
    if notEquals(integer(value 32), byte 144):
        jump label_137
    fi

    if hasBit(byte 235, value 0):
        print('"Hello again."')

    else:
        print('"Hello."')
    fi

    print(' She bows formally.\n')
    jump label_283

label_137:
    print('She bows stiffly. "I\'m sorry, good ')

    if integer(value 16):
        print('madam')

    else:
        print('sir')
    fi

    print(', but my shop is closed for now."')
    wait()

    print('\n\n"See me some other time, when I am available for business."\n')
    bye()

label_283:
    ask()

    case 'name':
        print('"Marissa. You may call me \'@Miss Trihune."\n')
        ('SETF', ('byte', 235), ('value', 0))
        jump label_283

    case 'miss':
    case 'trih':
        print('"Yes, that is much better."\n')
        jump label_283

    case 'buy':
    case 'clot':
    case 'dres':
    case 'pant':
    case 'tuni':
        jump label_1892

    case 'sell':
        jump label_2550

    case 'silk':
        print('"Yes, I can work with silk. But \'tis out of fashion..."')
        wait()

        print('\n\n"Nobody wears silk clothes this season."\n')
        jump label_283

    case 'arbe':
        print('"Oh, he\'s a threadmaker who lives here in town."')
        wait()

        print('\n\n"Silly little man, but a fine spinner."')
        wait()

        print('\n\n"I get all my thread straight from him. No other source would do."\n')
        jump label_283

    case 'bolt':
        print('"Yes, that silly Arbeth person can spin spidersilk into thread."')
        wait()

        print('\n\n"Charlotte, from New Magincia, weaves thread into silk cloth."')
        wait()

        print('\n\n"Bring me a bolt of her finest silk cloth, and then I can sew you a ')
        print('silk bag."\n')
        jump label_283

    case 'bag':
    case 'ball':
    case 'mamm':
    case 'plan':
        print('"Oh, I understand. A large silk bag."')
        wait()

        print('\n\n"Well, \'tis hardly a challenge for one of my skills. But, since it ')
        print('is important, I\'ll do it."')
        wait()

        print('\n\n')

        if equals(partyHasObject(word 270, byte 0), word 32769):
            print('"But I\'ll need to see the plans."\n')
            jump label_283
        fi

        integer(value 0) = partyHasObject(byte 241, byte 0)

        if equals(integer(value 0), word 32769):
            print('"But I\'ll need a @bolt of silk to do it, of course."\n')
            jump label_283
        fi

        jump label_1477

    case 'job':
        print('"I create garments of the highest @fashion."\n')
        jump label_283

    case 'fash':
    case 'high':
        print('"Clothes fit to see the King in."\n')
        jump label_283

    case 'bye':
        print('"Yes, well, come see me again." She yawns widely.\n')
        bye()

    case '*':
        if random(byte 0, byte 1):
            print('"Hmph! I am not a gossip, $G."\n')

        else:
            print('"\'Tis not my place to speak of that..."\n')
        fi

        jump label_283
    esac

    // Unreachable code!
    jump label_283

label_1477:
    print('"But it will cost you 75 gold. Alright?" ')

    choice('yn')

    case 'y':
        if less(objectsCount(integer(value 0), byte 88), byte 75):
            ('SETNAME', ('integer', [('value', 0)]))
            print('"Come back when you have the gold, $Y."\n')
            jump label_283
        fi

        ('DELETE', ('integer', [('value', 0)]), ('byte', 88), ('byte', 0), ('byte', 75))
        ('DELETE', ('integer', [('value', 0)]), ('byte', 241), ('byte', 0), ('byte', 1))
        print('She takes the silk cloth and begins to work, following the balloon ')
        print('plans.')
        wait()

        print('\n\nShe works in silence, intent on her sewing.')
        wait()

        print('\n\nAfter a while, she completes the silk bag.')
        wait()

        print('\n\n"There, \'tis done!" she cries, handing you the bag.\n')
        ('NEW', ('integer', [('value', 0)]), ('word', 421), ('byte', 0), ('byte', 1))
        jump label_283

    case 'n':
        print('"Very well," she sniffs, offended.\n')
        jump label_283
    esac

label_1892:
    if equals(integer(value 23), byte 0):
        integer(value 3) = character(byte 0, byte 0)
        jump label_2080
    fi

label_1915:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_1929:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#2. $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_1929
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        print('"Suit yourself," she sniffs, offended.\n')
        jump label_283
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_1915
    fi

    integer(value 3) = character(integer(value 3), byte 0)

label_2080:
    print('1. Tunic\n2. Dress\n3. Pants\n"Which one?" ')
    ('INPUTNUM', 0)

    if or(less(integer(value 0), byte 1), greater(integer(value 0), byte 3)):
        print('\n\n')
        jump label_2080
    fi

    integer(value 0) = minus(integer(value 0), byte 1)
    integer(value 1) = data(dword 3258, integer(value 0))
    string(value 0) = data(dword 3270, integer(value 0))
    print('"It\'ll cost you #1 gold for that $0. Interested?" ')

    choice('yn')

    case 'y':
        if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(dword 3264, integer(value 0)), byte 1)):
            print('"You look pretty full to me."\n')
            jump label_283
        fi

        if greaterOrEquals(objectsCount(integer(value 3), byte 88), data(dword 3258, integer(value 0))):
            ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('data', [('dword', 3258), ('integer', [('value', 0)])]))
            ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 3264), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 1))
            ('SETNAME', ('integer', [('value', 3)]))
            print('"Excellent!" After accepting $Y\'s gold, $N hands over the $0.\n')
            jump label_283

        else:
            ('SETNAME', ('integer', [('value', 3)]))
            print('$N looks at $Y. "How rude! Don\'t ask for something you can\'t pay for!"')
            print('\n')
            jump label_283
        fi

    case 'n':
        print('"Suit yourself," she sniffs, offended.\n')
        jump label_283
    esac

label_2550:
    integer(value 0) = byte 0
    integer(value 2) = byte 0
    integer(value 3) = byte 0

label_2571:
    integer(value 1) = byte 0

label_2578:
    if objectsCount(character(integer(value 0), byte 0), byte 185):
        data(dword 3242, integer(value 2)) = integer(value 0)
        integer(value 2) = plus(integer(value 2), byte 1)
        integer(value 3) = byte 1
        jump label_2647
    fi

    integer(value 1) = plus(integer(value 1), byte 1)

    if less(integer(value 1), byte 7):
        jump label_2578
    fi

label_2647:
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_2571
    fi

    if equals(integer(value 3), byte 0):
        print('"Sorry, none of you has anything of interest."\n')
        jump label_283
    fi

    if equals(integer(value 2), byte 1):
        integer(value 3) = character(data(dword 3242, byte 0), byte 0)
        jump label_2944
    fi

label_2759:
    integer(value 0) = byte 0
    integer(value 1) = byte 1

label_2773:
    ('SETNAME', ('character', [('data', [('dword', 3242), ('integer', [('value', 0)])]), ('byte', 0)]))
    print('#1. $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 1) = plus(integer(value 1), byte 1)

    if less(integer(value 0), integer(value 2)):
        jump label_2773
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        print('"Just as well. That cloth is rather shabby..."\n')
        jump label_283
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greaterOrEquals(integer(value 3), integer(value 2)):
        jump label_2759
    fi

    integer(value 3) = character(data(dword 3242, integer(value 3)), byte 0)

label_2944:
    integer(value 4) = objectsCount(integer(value 3), byte 185)
    ('SETNAME', ('integer', [('value', 3)]))

    if equals(integer(value 4), byte 0):
        print('"I don\'t see any cloth, other than what you\'re wearing!"\n')
        jump label_283
    fi

    print('$N turns to $Y and asks "Will you take 20 gold for that cloth?" ')

    choice('yn')

    case 'y':
        print('"Done!" She hands $Y 20 gold pieces and takes the cloth.\n')
        ('DELETE', ('integer', [('value', 3)]), ('byte', 185), ('byte', 0), ('byte', 1))
        ('NEW', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('byte', 20))
        jump label_283

    case 'n':
        print('"Just as well. That cloth is rather shabby..."\n')
        jump label_283
    esac

integers_3242 = [
    0, // 0
    0, // 1
    0, // 2
    0, // 3
    0, // 4
    0, // 5
    0, // 6
    0, // 7
]

integers_3258 = [
    15, // 0
    30, // 1
    20, // 2
]

integers_3264 = [
    124, // 0
    126, // 1
    137, // 2
]

strings_3270 = [
    'Smart tunic',   // 0
    'Fine dress',    // 1
    'Pair of pants', // 2
]
