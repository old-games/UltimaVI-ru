source("CONVERSE.A")
index(44)

id(44)
name("Nomaan")

description:
    print("a blond man with broad shoulders and a stern, unsmiling face.")

    f3()

interaction:
    wait()

    print("\n")

    if equals(integer(value 32), byte 153):
        print("\"Can't you see there's a lovely brawl going on? Talk to me tomorrow.\"\n")
        bye()
    fi

    integer(value 8) = byte 7

    if hasBit(byte 235, value 0):
        print("\"Hello again, $G.\"")
        jump 307

    else:
        print("\"I am Nomaan. What is thy name, $G?\"\n")

        ask()
        print("\nHe bows stiffly. \"Well met, $G.\"")
        ('SETF', ('byte', 235), ('value', 0))
        jump 307
    fi

273:
    print("\n\"What else can I help thee with?\"\n")

307:
    print("\n")

    ask()

    case "buy":
        print("\"Certainly, $G.\"")
        wait()

        print("\n\n\"Wouldst thou like @armaments or @ammunition?\"")
        jump 307

    case "arm":
        if notEquals(integer(value 32), byte 144):
            print("\"Come by my shop when I'm open!\"")
            jump 307

        else:
            integer(value 9) = byte 0
            jump 2675
        fi

    case "amm":
        if notEquals(integer(value 32), byte 144):
            print("\"Come by my shop when I'm open!\"")
            jump 307

        else:
            integer(value 9) = integer(value 8)
            jump 3292
        fi

    case "sell":
        if notEquals(integer(value 32), byte 144):
            print("\"Come by my shop when I'm open!\"")
            jump 307

        else:
            jump 1758
        fi

    case "name":
        print("\"@Naughty Nomaan, they call me.\"")
        jump 307

    case "job":
        print("\"I run the armoury, @buying and @selling weapons.\"")
        jump 307

    case "naug":
        print("\"'Tis just a nickname, of course.\"")
        wait()

        print("\n\nYou see a hint of a smile on his face.")
        jump 307

    case "rune":
        print("\"I won a rune in a tournament once.\"")
        wait()

        print("\n\n\"'Tis gone now, though - and there's a fine @tale about it!\"")
        jump 307

    case "gone":
    case "tale":
        print("\"I remember it as if it were yesterday...\"")
        wait()

        print("\n\n\"Zellivan held a tourney and I was awarded the Rune of Valour.\"")
        wait()

        print("\n\n\"Afterwards, we were at the pub, celebrating.\"")
        wait()

        print("\n\n\"I had drunk a full quart of ale, so my grip was a bit unsteady.\"")
        wait()

        print("\n\n\"I was showing the rune around when it fell from my grasp onto the ")
        print("floor.\"")
        wait()

        print("\n\n\"That's when the @rat ran out.\"")
        jump 307

    case "rat":
        print("\"It scampered over, seized the trinket and ran back 'cross the floor.\"")
        wait()

        print("\n\n\"We all leapt at it, but the little beast was too quick.\"")
        wait()

        print("\n\n\"It was in the @hole before anybody could stop it.\"")
        jump 307

    case "hole":
        print("\"It ran into a hole in the west wall of the pub, carrying the rune.\"")
        wait()

        print("\n\n\"We tried everything - banging on the wall, digging, poking with a ")
        print("sword.\"")
        wait()

        print("\n\n\"To no avail, though. We haven't seen the rune since.\"")
        jump 307

    case "mant":
        print("\"Go ask around in the tavern.\"")
        jump 307

    case "bye":
        print("\"A fine $T to you, $G.\"\n")
        bye()

    case "*":
        print("\"Hmm...\"")
        wait()

        print("\n\n\"Nope, I fear I know nothing of that, $G.\"")
        jump 307
    esac

1758:
    integer(value 0) = byte 0
    integer(value 2) = byte 0
    integer(value 3) = byte 0

1779:
    integer(value 1) = byte 0

1786:
    if hasObject(character(integer(value 0), byte 0), data(dword 4111, integer(value 1)), byte 0):
        data(dword 4227, integer(value 2)) = integer(value 0)
        integer(value 2) = plus(integer(value 2), byte 1)
        integer(value 3) = byte 1
        jump 1863
    fi

    integer(value 1) = plus(integer(value 1), byte 1)

    if less(integer(value 1), integer(value 8)):
        jump 1786
    fi

1863:
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump 1779
    fi

    if equals(integer(value 3), byte 0):
        print("\"Sorry, none of you has anything I need.\"")
        wait()

        print("\n")
        jump 273
    fi

    if equals(integer(value 2), byte 1):
        integer(value 3) = character(data(dword 4227, byte 0), byte 0)
        ('SETNAME', ('integer', [('value', 3)]))
        print("\"Aye, $Y has something of interest...\"")
        wait()

        print("\n\n")
        jump 2140
    fi

2016:
    integer(value 1) = byte 1

2023:
    ('SETNAME', ('character', [('data', [('dword', 4227), ('minus', [('integer', [('value', 1)]), ('byte', 1)])]), ('byte', 0)]))
    print("#1) $Y\n")
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 2)):
        jump 2023
    fi

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump 2644
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greaterOrEquals(integer(value 3), integer(value 2)):
        jump 2016
    fi

    integer(value 3) = character(data(dword 4227, integer(value 3)), byte 0)

2140:
    integer(value 0) = byte 0
    integer(value 5) = byte 0

2154:
    if equals(hasObject(integer(value 3), data(dword 4111, integer(value 0)), byte 0), byte 0):
        jump 2201
    fi

    data(dword 4197, integer(value 5)) = integer(value 0)
    integer(value 5) = plus(integer(value 5), byte 1)

2201:
    integer(value 0) = plus(integer(value 0), byte 1)

    if less(integer(value 0), integer(value 8)):
        jump 2154
    fi

    if equals(integer(value 5), byte 1):
        integer(value 6) = data(dword 4197, byte 0)
        jump 2362
    fi

    integer(value 0) = byte 1

2257:
    print("#0) ")
    ('DPRINT', ('dword', 4131), ('data', [('dword', 4197), ('minus', [('integer', [('value', 0)]), ('byte', 1)])]))
    print("\n")
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 5)):
        jump 2257
    fi

    print("\"Which item?\" ")
    ('INPUTNUM', 6)

    if greater(integer(value 6), integer(value 5)):
        jump 2140
    fi

    if equals(integer(value 6), byte 0):
        jump 2644
    fi

    integer(value 6) = data(dword 4197, minus(integer(value 6), byte 1))

2362:
    string(value 0) = data(dword 4131, integer(value 6))
    integer(value 7) = divide(data(dword 4093, integer(value 6)), byte 2)
    ('SETNAME', ('integer', [('value', 3)]))
    print("\"Will you take #7 gold for that $0, $Y?\" ")

    askc("yn")

    case "n":
        if equals(integer(value 5), byte 1):
            print("\"Perhaps some other time, then.\"")
            wait()

            print("\n")
            jump 273

        else:
            print("\"Perhaps something else then?\"")
            wait()

            print("\n\n")
            jump 2140
        fi

    case "y":
        ('SETNAME', ('integer', [('value', 3)]))
        print("\"Done!\" $N hands $Y #7 gold pieces and takes the $0.")
        ('DELETE', ('integer', [('value', 3)]), ('data', [('dword', 4111), ('integer', [('value', 6)])]), ('byte', 0), ('byte', 1))
        ('NEW', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 7)]))

        if equals(integer(value 5), byte 1):
            print("*\n")
            jump 273

        else:
            wait()

            print("\n\n")
            jump 2140
        fi
    esac

2644:
    print("\"Changed your mind, eh?\"")
    wait()

    print("\n")
    jump 273

2675:
    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 0
        jump 2821
    fi

2695:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

2709:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print("#2) $Y\n")
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump 2709
    fi

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump 2644
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump 2695
    fi

    integer(value 3) = character(integer(value 3), byte 0)

2821:
    integer(value 0) = byte 1
    ('SETNAME', ('integer', [('value', 3)]))

2832:
    string(value 0) = data(dword 4131, plus(integer(value 9), minus(integer(value 0), byte 1)))
    print("#0) $0\n")
    integer(value 0) = plus(integer(value 0), byte 1)

    if and(integer(value 9), notEquals(data(dword 4111, plus(integer(value 9), minus(integer(value 0), byte 1))), byte 0)):
        jump 2832
    fi

    if and(equals(integer(value 9), byte 0), lessOrEquals(integer(value 0), integer(value 8))):
        jump 2832
    fi

    integer(value 7) = integer(value 0)
    print("\"Which item?\" ")
    ('INPUTNUM', 0)

    if equals(integer(value 0), byte 0):
        jump 2644
    fi

    if greaterOrEquals(integer(value 0), integer(value 7)):
        jump 2821
    fi

    integer(value 0) = minus(plus(integer(value 9), integer(value 0)), byte 1)
    integer(value 1) = data(dword 4093, integer(value 0))
    string(value 1) = data(dword 4131, integer(value 0))
    print("\"That $1 costs #1 gold.\"")
    wait()

    print("\n\n\"Interested, $Y?\" ")

    askc("yn")

    case "y":
        jump 3069

    case "n":
        jump 2821
    esac

3069:
    if less(canCarry(integer(value 3)), weight(data(dword 4111, integer(value 0)), byte 1)):
        print("\"But 'twould make thee o'erburdened, $Y!\"")
        wait()

        print("\n")
        jump 273
    fi

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
        ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
        ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 4111), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 1))
        print("\"Excellent!\"\n\nAfter accepting $Y's gold, $N hands over the $1.")
        wait()

        print("\n\n")
        jump 2821

    else:
        print("\"But thou hast not enough gold, $Y!\"")
        wait()

        print("\n")
        jump 273
    fi

3292:
    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 1
        jump 3438
    fi

3312:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

3326:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print("#2) $Y\n")
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump 3326
    fi

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump 2644
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump 3312
    fi

    integer(value 3) = character(integer(value 3), byte 0)

3438:
    ('SETNAME', ('integer', [('value', 3)]))
    print("1) Arrows\n2) Bolts\n")
    integer(value 7) = byte 2
    print("\"Which kind?\" ")
    ('INPUTNUM', 0)

    if equals(integer(value 0), byte 0):
        jump 2644
    fi

    if greater(integer(value 0), integer(value 7)):
        jump 3438
    fi

    integer(value 0) = minus(plus(integer(value 9), integer(value 0)), byte 1)
    integer(value 1) = data(dword 4093, integer(value 0))
    string(value 1) = data(dword 4131, integer(value 0))
    print("\"I only sell $1s by the dozen.\"")
    wait()

    print("\n\n\"How many dozens do you want, $Y?\" ")
    ('INPUT', 5)

    if equals(integer(value 5), byte 0):
        jump 2644
    fi

    if greater(integer(value 5), byte 100):
        jump 3584
    fi

    integer(value 6) = byte 0

3655:
    if less(canCarry(integer(value 3)), weight(data(dword 4111, integer(value 0)), byte 12)):
        jump 3829
    fi

    if less(objectsCount(integer(value 3), byte 88), integer(value 1)):
        jump 3960
    fi

    ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
    ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 4111), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 12))
    integer(value 6) = plus(integer(value 6), byte 1)

    if equals(integer(value 6), integer(value 5)):
        print("\"Excellent!\"\n\nAfter accepting $Y's gold, $N hands over ")
        integer(value 6) = multiply(byte 12, integer(value 6))
        print("#6 $1s.")
        wait()

        print("\n")
        jump 273

    else:
        jump 3655
    fi

3829:
    if integer(value 6):
        print("\"Thou canst not carry that many, but I will give thee ")
        integer(value 6) = multiply(byte 12, integer(value 6))
        print("#6 $1s, $Y.\"")
        wait()

        print("\n")
        jump 273

    else:
        print("\"Thou canst not carry any $1s, $Y!\"")
        wait()

        print("\n")
        jump 273
    fi

3960:
    if integer(value 6):
        print("\"Thou canst not afford that many, but I will give thee ")
        integer(value 6) = multiply(byte 12, integer(value 6))
        print("#6 $1s, $Y.\"")
        wait()

        print("\n")
        jump 273

    else:
        print("\"Thou canst not afford any $1s, $Y!\"")
        wait()

        print("\n")
        jump 273
    fi

    ('INTEGERS', [30, 10, 40, 10, 2, 15, 25, 4, 3], [])
    ('INTEGERS', [41, 34, 42, 38, 83, 36, 13, 55, 56, 0], [])
    ('STRINGS', ['Bow', 'Club', 'Crossbow', 'Dagger', 'Oil Flask', 'Spear', 'Spiked Shield', 'arrow', 'bolt'], [])
    ('INTEGERS', [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [])
    ('INTEGERS', [0, 0, 0, 0, 0, 0, 0, 0], [])
