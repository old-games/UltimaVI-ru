source("CONVERSE.B")
index(21)

id(120)
name("Enrik")

description:
    print("a scarred man with a gap-toothed grin and large, calloused hands.")

interaction:
    wait()

    print("\n")

    if equals(integer(value 32), byte 153):
    print("\"Don't like talking when I'm fighting!\"\n")
    bye()

    endif

    integer(value 8) = byte 5

    if hasBit(byte 235, value 0):
    jump 172

    endif

    print("\"Hello, hello.\"")
    ('SETF', ('byte', 235), ('value', 0))
    wait()

    print("\n")
    jump 230

172:
    print("\"Right. You been here before.\" He studies you carefully.\n")
    wait()

    print("\n\"What'll it be?\"\n")

    ask()
    case "buy":
    print("\"Hey, what's it look like, I'm a mind reader?\"")
    wait()

    print("\n\n\"Do ya want @arms or @armor?\"")
    jump 247

    case "armo":

    if notEquals(integer(value 32), byte 144):
    print("\"Come by my shop when I'm open!\"")
    jump 247

    else:
    integer(value 9) = integer(value 8)
    jump 1829

    endif

    case "arm,arms":

    if notEquals(integer(value 32), byte 144):
    print("\"Come by my shop when I'm open!\"")
    jump 247

    else:
    integer(value 9) = byte 0
    jump 1829

    endif

    case "sell":

    if notEquals(integer(value 32), byte 144):
    print("\"Come by my shop when I'm open!\"")
    jump 247

    else:
    jump 921

    endif

    case "job":
    print("\"And my mutter said I was thick.\"")
    wait()

    print("\n\n\"You can @buy's arms from me or @sell me yer used stuff.\"")
    jump 247

    case "name":
    print("\"@Enrik. Enrik the @Hammer's what I'm known as 'round here.\"")
    jump 247

    case "enri":
    print("\"I prefers @Hammer.\"")
    jump 247

    case "hamm":
    print("\"They call me that 'cause I's got a good @left.\"")
    jump 247

    case "good,left":
    print("\"Keep it up and I'll show ya,\" he growls.")
    jump 247

    case "bye":
    print("\"Yeah, gotta get back ta work.\"\n")
    bye()

    case "*":
    print("He gives you a blank stare.")
    jump 247

920:
    esac

921:
    integer(value 0) = byte 0
    integer(value 2) = byte 0
    integer(value 3) = byte 0
    integer(value 1) = byte 0

    if hasObject(character(integer(value 0), byte 0), data(dword 2461, integer(value 1)), byte 0):
    data(dword 2597, integer(value 2)) = integer(value 0)
    integer(value 2) = plus(integer(value 2), byte 1)
    integer(value 3) = byte 1
    jump 1029

    endif

    integer(value 1) = plus(integer(value 1), byte 1)

    if data(dword 2461, integer(value 1)):
    jump 949

    endif

    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
    jump 942

    endif

    if equals(integer(value 3), byte 0):
    print("\"Sorry, none of you's got anything I need.\"")
    wait()

    jump 230

    endif

    if equals(integer(value 2), byte 1):
    integer(value 3) = character(data(dword 2597, byte 0), byte 0)
    ('SETNAME', ('integer', [('value', 3)]))
    print("\"Aye, $Y has somethin' interestin'...\"")
    wait()

    print("\n\n")
    jump 1307

    endif

    integer(value 1) = byte 1
    ('SETNAME', ('character', [('data', [('dword', 2597), ('minus', [('integer', [('value', 1)]), ('byte', 1)])]), ('byte', 0)]))
    print("#1) $Y\n")
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 2)):
    jump 1190

    endif

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
    jump 1798

    endif

    integer(value 3) = minus(integer(value 3), byte 1)

    if greaterOrEquals(integer(value 3), integer(value 2)):
    jump 1183

    endif

    integer(value 3) = character(data(dword 2597, integer(value 3)), byte 0)
    integer(value 0) = byte 0
    integer(value 5) = byte 0

    if equals(hasObject(integer(value 3), data(dword 2461, integer(value 0)), byte 0), byte 0):
    jump 1368

    endif

    data(dword 2567, integer(value 5)) = integer(value 0)
    integer(value 5) = plus(integer(value 5), byte 1)
    integer(value 0) = plus(integer(value 0), byte 1)

    if data(dword 2461, integer(value 0)):
    jump 1321

    endif

    if equals(integer(value 5), byte 1):
    integer(value 6) = data(dword 2567, byte 0)
    jump 1532

    endif

    integer(value 0) = byte 1
    print("#0) ")
    ('DPRINT', [('data', [('dword', 2567), ('minus', [('integer', [('value', 0)]), ('byte', 1)])]), ('dword', 2479)])
    print("\n")
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 5)):
    jump 1427

    endif

    print("\"Which item?\" ")
    ('INPUTNUM', 6)

    if greater(integer(value 6), integer(value 5)):
    jump 1307

    endif

    if equals(integer(value 6), byte 0):
    jump 1798

    endif

    integer(value 6) = data(dword 2567, minus(integer(value 6), byte 1))
    string(value 0) = data(dword 2479, integer(value 6))
    integer(value 7) = divide(data(dword 2445, integer(value 6)), byte 2)
    ('SETNAME', ('integer', [('value', 3)]))
    print("\"Will you take #7 gold for that $0, $Y?\" ")

    askc("yn")
    case "n":

    if equals(integer(value 5), byte 1):
    print("\"Mebbe some other time.\"")
    wait()

    print("\n")
    jump 230

    else:
    print("\"Mebbe somethin' else?\"")
    wait()

    print("\n\n")
    jump 1307

    endif

    case "y":
    ('SETNAME', ('integer', [('value', 3)]))
    print("\"Done!\" $N hands $Y #7 gold pieces and takes the $0.")
    ('DELETE', ('integer', [('value', 3)]), ('data', [('dword', 2461), ('integer', [('value', 6)])]), ('byte', 0), ('byte', 1))
    ('NEW', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 7)]))

    if equals(integer(value 5), byte 1):
    print("\n")
    jump 230

    else:
    wait()

    print("\n\n")
    jump 1307

1796:
    endif

    esac

1798:
    print("\"Changed your mind, eh?\"")
    wait()

    print("\n")
    jump 230

1829:
    if equals(integer(value 23), byte 0):
    integer(value 3) = byte 0
    jump 1975

    endif

    integer(value 0) = byte 0
    integer(value 2) = byte 1
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print("#2) $Y\n")
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
    jump 1863

    endif

    print("\"Which of you?\" ")
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
    jump 1798

    endif

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
    jump 1849

    endif

    integer(value 3) = character(integer(value 3), byte 0)
    integer(value 0) = byte 1
    ('SETNAME', ('integer', [('value', 3)]))
    string(value 0) = data(dword 2479, plus(integer(value 9), minus(integer(value 0), byte 1)))
    print("#0) $0\n")
    integer(value 0) = plus(integer(value 0), byte 1)

    if and(integer(value 9), notEquals(data(dword 2461, plus(integer(value 9), minus(integer(value 0), byte 1))), byte 0)):
    jump 1986

    endif

    if and(equals(integer(value 9), byte 0), lessOrEquals(integer(value 0), integer(value 8))):
    jump 1986

    endif

    integer(value 7) = integer(value 0)
    print("\"Which item?\" ")
    ('INPUTNUM', 0)

    if equals(integer(value 0), byte 0):
    jump 1798

    endif

    if greaterOrEquals(integer(value 0), integer(value 7)):
    jump 1975

    endif

    integer(value 0) = minus(plus(integer(value 9), integer(value 0)), byte 1)
    integer(value 1) = data(dword 2445, integer(value 0))
    string(value 1) = data(dword 2479, integer(value 0))
    print("\"That $1 costs #1 gold.\"")
    wait()

    print("\n\n\"Interested, $Y?\" ")

    askc("yn")
    case "y":
    jump 2223

    case "n":
    jump 1975

2222:
    esac

2223:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(dword 2461, integer(value 0)), byte 1)):
    print("\"But that'd make you o'erburdened, $Y!\"")
    wait()

    print("\n")
    jump 230

    endif

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
    ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
    ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 2461), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 1))
    print("\"Good!\"\n\nAfter accepting $Y's gold, $N hands over the $1.")
    wait()

    print("\n\n")
    jump 1975

    else:
    print("\"But you don't got enough gold, $Y!\"")
    wait()

    print("\n")
    jump 230

2444:
    endif

2445:
    ['INTEGERS', [10, 10, 25, 4, 20, 20, 40, 10]]

2461:
    ['INTEGERS', [34, 38, 35, 83, 37, 17, 18, 1, 0]]

2479:
    ['STRINGS', ['Club', 'Dagger', 'Main Gauche', 'Oil Flask', 'Throwing Axe', 'Cloth Armour', 'Leather Armour', 'Leather Helm']]

2567:
    ['INTEGERS', [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]

2597:
    ['INTEGERS', [0, 0, 0, 0, 0, 0, 0, 0]]
