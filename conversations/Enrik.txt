source('CONVERSE.B')
index(21)

id(120)
name('Enrik')

description:
    print('a scarred man with a gap-toothed grin and large, calloused hands.')

interaction:
    wait()

    print('\n')

    if equals(integer(value 32), byte 153):
        print('"Don\'t like talking when I\'m fighting!"\n')
        bye()
    fi

    integer(value 8) = byte 5

    if hasBit(byte 235, value 0):
        jump label_172
    fi

    print('"Hello, hello."')
    ('SETF', ('byte', 235), ('value', 0))
    wait()

    print('\n')
    jump label_230

label_172:
    print('"Right. You been here before." He studies you carefully.\n')
    wait()

label_230:
    print('\n"What\'ll it be?"\n')

    ask()

    case 'buy':
        print('"Hey, what\'s it look like, I\'m a mind reader?"')
        wait()

        print('\n\n"Do ya want @arms or @armor?"')
        jump label_247

    case 'armo':
        if notEquals(integer(value 32), byte 144):
            print('"Come by my shop when I\'m open!"')
            jump label_247

        else:
            integer(value 9) = integer(value 8)
            jump label_1829
        fi

    case 'arm':
    case 'arms':
        if notEquals(integer(value 32), byte 144):
            print('"Come by my shop when I\'m open!"')
            jump label_247

        else:
            integer(value 9) = byte 0
            jump label_1829
        fi

    case 'sell':
        if notEquals(integer(value 32), byte 144):
            print('"Come by my shop when I\'m open!"')
            jump label_247

        else:
            jump label_921
        fi

    case 'job':
        print('"And my mutter said I was thick."')
        wait()

        print('\n\n"You can @buy\'s arms from me or @sell me yer used stuff."')
        jump label_247

    case 'name':
        print('"@Enrik. Enrik the @Hammer\'s what I\'m known as \'round here."')
        jump label_247

    case 'enri':
        print('"I prefers @Hammer."')
        jump label_247

    case 'hamm':
        print('"They call me that \'cause I\'s got a good @left."')
        jump label_247

    case 'good':
    case 'left':
        print('"Keep it up and I\'ll show ya," he growls.')
        jump label_247

    case 'bye':
        print('"Yeah, gotta get back ta work."\n')
        bye()

    case '*':
        print('He gives you a blank stare.')
        jump label_247
    esac

label_921:
    integer(value 0) = byte 0
    integer(value 2) = byte 0
    integer(value 3) = byte 0

label_942:
    integer(value 1) = byte 0

label_949:
    if hasObject(character(integer(value 0), byte 0), data(dword 2461, integer(value 1)), byte 0):
        data(dword 2597, integer(value 2)) = integer(value 0)
        integer(value 2) = plus(integer(value 2), byte 1)
        integer(value 3) = byte 1
        jump label_1029
    fi

    integer(value 1) = plus(integer(value 1), byte 1)

    if data(dword 2461, integer(value 1)):
        jump label_949
    fi

label_1029:
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_942
    fi

    if equals(integer(value 3), byte 0):
        print('"Sorry, none of you\'s got anything I need."')
        wait()

        jump label_230
    fi

    if equals(integer(value 2), byte 1):
        integer(value 3) = character(data(dword 2597, byte 0), byte 0)
        ('SETNAME', ('integer', [('value', 3)]))
        print('"Aye, $Y has somethin\' interestin\'..."')
        wait()

        print('\n\n')
        jump label_1307
    fi

label_1183:
    integer(value 1) = byte 1

label_1190:
    ('SETNAME', ('character', [('data', [('dword', 2597), ('minus', [('integer', [('value', 1)]), ('byte', 1)])]), ('byte', 0)]))
    print('#1) $Y\n')
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 2)):
        jump label_1190
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump label_1798
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greaterOrEquals(integer(value 3), integer(value 2)):
        jump label_1183
    fi

    integer(value 3) = character(data(dword 2597, integer(value 3)), byte 0)

label_1307:
    integer(value 0) = byte 0
    integer(value 5) = byte 0

label_1321:
    if equals(hasObject(integer(value 3), data(dword 2461, integer(value 0)), byte 0), byte 0):
        jump label_1368
    fi

    data(dword 2567, integer(value 5)) = integer(value 0)
    integer(value 5) = plus(integer(value 5), byte 1)

label_1368:
    integer(value 0) = plus(integer(value 0), byte 1)

    if data(dword 2461, integer(value 0)):
        jump label_1321
    fi

    if equals(integer(value 5), byte 1):
        integer(value 6) = data(dword 2567, byte 0)
        jump label_1532
    fi

    integer(value 0) = byte 1

label_1427:
    print('#0) ')
    ('DPRINT', ('dword', 2479), ('data', [('dword', 2567), ('minus', [('integer', [('value', 0)]), ('byte', 1)])]))
    print('\n')
    integer(value 0) = plus(integer(value 0), byte 1)

    if lessOrEquals(integer(value 0), integer(value 5)):
        jump label_1427
    fi

    print('"Which item?" ')
    ('INPUTNUM', 6)

    if greater(integer(value 6), integer(value 5)):
        jump label_1307
    fi

    if equals(integer(value 6), byte 0):
        jump label_1798
    fi

    integer(value 6) = data(dword 2567, minus(integer(value 6), byte 1))

label_1532:
    string(value 0) = data(dword 2479, integer(value 6))
    integer(value 7) = divide(data(dword 2445, integer(value 6)), byte 2)
    ('SETNAME', ('integer', [('value', 3)]))
    print('"Will you take #7 gold for that $0, $Y?" ')

    choice('yn')

    case 'n':
        if equals(integer(value 5), byte 1):
            print('"Mebbe some other time."')
            wait()

            print('\n')
            jump label_230

        else:
            print('"Mebbe somethin\' else?"')
            wait()

            print('\n\n')
            jump label_1307
        fi

    case 'y':
        ('SETNAME', ('integer', [('value', 3)]))
        print('"Done!" $N hands $Y #7 gold pieces and takes the $0.')
        ('DELETE', ('integer', [('value', 3)]), ('data', [('dword', 2461), ('integer', [('value', 6)])]), ('byte', 0), ('byte', 1))
        ('NEW', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 7)]))

        if equals(integer(value 5), byte 1):
            print('\n')
            jump label_230

        else:
            wait()

            print('\n\n')
            jump label_1307
        fi
    esac

label_1798:
    print('"Changed your mind, eh?"')
    wait()

    print('\n')
    jump label_230

label_1829:
    if equals(integer(value 23), byte 0):
        integer(value 3) = byte 0
        jump label_1975
    fi

label_1849:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_1863:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#2) $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_1863
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        jump label_1798
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_1849
    fi

    integer(value 3) = character(integer(value 3), byte 0)

label_1975:
    integer(value 0) = byte 1
    ('SETNAME', ('integer', [('value', 3)]))

label_1986:
    string(value 0) = data(dword 2479, plus(integer(value 9), minus(integer(value 0), byte 1)))
    print('#0) $0\n')
    integer(value 0) = plus(integer(value 0), byte 1)

    if and(integer(value 9), notEquals(data(dword 2461, plus(integer(value 9), minus(integer(value 0), byte 1))), byte 0)):
        jump label_1986
    fi

    if and(equals(integer(value 9), byte 0), lessOrEquals(integer(value 0), integer(value 8))):
        jump label_1986
    fi

    integer(value 7) = integer(value 0)
    print('"Which item?" ')
    ('INPUTNUM', 0)

    if equals(integer(value 0), byte 0):
        jump label_1798
    fi

    if greaterOrEquals(integer(value 0), integer(value 7)):
        jump label_1975
    fi

    integer(value 0) = minus(plus(integer(value 9), integer(value 0)), byte 1)
    integer(value 1) = data(dword 2445, integer(value 0))
    string(value 1) = data(dword 2479, integer(value 0))
    print('"That $1 costs #1 gold."')
    wait()

    print('\n\n"Interested, $Y?" ')

    choice('yn')

    case 'y':
        jump label_2223

    case 'n':
        jump label_1975
    esac

label_2223:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(dword 2461, integer(value 0)), byte 1)):
        print('"But that\'d make you o\'erburdened, $Y!"')
        wait()

        print('\n')
        jump label_230
    fi

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
        ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
        ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 2461), ('integer', [('value', 0)])]), ('byte', 0), ('byte', 1))
        print('"Good!"\n\nAfter accepting $Y\'s gold, $N hands over the $1.')
        wait()

        print('\n\n')
        jump label_1975

    else:
        print('"But you don\'t got enough gold, $Y!"')
        wait()

        print('\n')
        jump label_230
    fi

integers_2445 = [
    10,
    10,
    25,
    4,
    20,
    20,
    40,
    10,
]

integers_2461 = [
    34,
    38,
    35,
    83,
    37,
    17,
    18,
    1,
    0,
]

strings_2479 = [
    'Club',
    'Dagger',
    'Main Gauche',
    'Oil Flask',
    'Throwing Axe',
    'Cloth Armour',
    'Leather Armour',
    'Leather Helm',
]

integers_2567 = [
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
]

integers_2597 = [
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
]
