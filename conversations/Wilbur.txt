source('CONVERSE.A')
index(27)

id(27)
name('Wilbur')

description:
    print('a thin, dark-haired man with a nervous smile.')
    wait()

    print('\n')

interaction:
    integer(value 9) = byte 75

    if hasBit(byte 235, value 0):
        print('"Hello again, my friend')

    else:
        print('"Greetings, traveler')
        ('SETF', ('byte', 235), ('value', 0))
    fi

    if integer(value 23):
        print('s! What can I do for you')

    else:
        print('! What can I do for thee')
    fi

    print(' this $T?"\n')

label_186:
    ask()

    case 'name':
        print('"My name\'s Wilbur, $G."')
        jump label_185

    case 'job':
        print('"I work here at the stables, taking care of the horses."')
        wait()

        print('\n\n"You can @buy one if you\'d like."')
        jump label_185

    case 'ed':
    case 'smit':
    case 'talk':
        print('"A talking horse? Ridiculous! Who told you that?"')
        wait()

        print('\n\nHe seems more nervous than before.')
        jump label_185

    case 'hors':
        print('"Aye, if you wish to @buy one, just say the word."')
        jump label_185

    case 'buy':
        jump label_550

    case 'bye':
        print('"Come back again!"\n')
        bye()

    case '*':
        print('"Beg pardon, $G?"')
        jump label_185
    esac

label_550:
    if greater(integer(value 23), byte 0):
        integer(value 1) = byte 0
        integer(value 2) = byte 0
        integer(value 4) = byte 0
        jump label_650
    fi

    integer(value 3) = character(byte 0, byte 0)

    if hasHorse(integer(value 3)):
        print('"But thou already hast a horse!"')
        jump label_185

    else:
        integer(value 4) = byte 1
        jump label_951
    fi

label_650:
    if greater(integer(value 1), integer(value 23)):
        jump label_757
    fi

    integer(value 3) = character(integer(value 1), byte 0)

    if hasHorse(integer(value 3)):
        jump label_742
    fi

    if equals(integer(value 4), byte 0):
        integer(value 4) = integer(value 3)
        integer(value 2) = plus(integer(value 2), byte 1)
        jump label_742
    fi

    ('SETNAME', ('integer', [('value', 4)]))
    print('#2) $Y\n')
    integer(value 2) = plus(integer(value 2), byte 1)
    integer(value 4) = integer(value 3)

label_742:
    integer(value 1) = plus(integer(value 1), byte 1)
    jump label_650

label_757:
    if equals(integer(value 2), byte 0):
        print('"But all of you are already on horses!"')
        jump label_185
    fi

    if equals(integer(value 2), byte 1):
        integer(value 3) = integer(value 4)
        jump label_951
    fi

    ('SETNAME', ('integer', [('value', 4)]))
    print('#2) $Y\n')
    integer(value 4) = byte 0
    print('"Which of you?" ')
    ('INPUTNUM', 2)

    if equals(integer(value 2), byte 0):
        jump label_186
    fi

    integer(value 1) = byte 0

label_886:
    integer(value 3) = character(integer(value 1), byte 0)

    if equals(hasHorse(integer(value 3)), byte 0):
        integer(value 2) = minus(integer(value 2), byte 1)
    fi

    if equals(integer(value 2), byte 0):
        jump label_951
    fi

    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 23)):
        jump label_886
    fi

label_951:
    ('SETNAME', ('integer', [('value', 3)]))
    print('"Aye, $Y, thou hast need of a horse."')
    wait()

    print('\n\n')

    if less(objectsCount(integer(value 3), byte 88), integer(value 9)):
        print('"But thou canst not afford one!"')
        jump label_1231
    fi

    print('"My price is #9 gold pieces, no less. Interested?" ')

    choice('yn')

    case 'y':
        print('"Good!" $N takes $Y\'s gold, and hands over the reins of a fine horse.')
        ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 9)]))
        horse(integer(value 3))
        jump label_1231

    case 'n':
        print('"Perhaps some other time then."')
        jump label_1231
    esac

label_1231:
    if integer(value 4):
        jump label_185
    fi

    wait()

    print('\n\n"How about ')

    if greater(integer(value 23), byte 1):
        print('one of thy friends')

    else:
        print('thy friend')
    fi

    print('?"')
    wait()

    print('\n\n')
    integer(value 1) = byte 0
    integer(value 2) = byte 0
    integer(value 4) = byte 0
    jump label_650
