source('CONVERSE.A')
index(27)

id(27)
name({
    'english': 'Wilbur',
    'russian': 'FIXME Wilbur'
})

description:
    print({
        'english': 'a thin, dark-haired man with a nervous smile.',
        'russian': 'FIXME a thin, dark-haired man with a nervous smile.'
    })
    wait()

    print({
        'english': '\n',
        'russian': 'FIXME \n'
    })

interaction:
    integer(value 9) = byte 75

    if hasBit(byte 235, value 0):
        print({
            'english': '"Hello again, my friend',
            'russian': 'FIXME "Hello again, my friend'
        })

    else:
        print({
            'english': '"Greetings, traveler',
            'russian': 'FIXME "Greetings, traveler'
        })
        setBit(byte 235, value 0)
    fi

    if integer(value 23):
        print({
            'english': 's! What can I do for you',
            'russian': 'FIXME s! What can I do for you'
        })

    else:
        print({
            'english': '! What can I do for thee',
            'russian': 'FIXME ! What can I do for thee'
        })
    fi

    print({
        'english': ' this $T?"',
        'russian': 'FIXME  this $T?"'
    })

label_185:
    print({
        'english': '\n',
        'russian': 'FIXME \n'
    })

label_186:
    ask()

    case {'english': 'name'}:
    case {'russian': 'FIXME name'}:
        print({
            'english': '"My name\'s Wilbur, $G."',
            'russian': 'FIXME "My name\'s Wilbur, $G."'
        })
        jump label_185

    case {'english': 'job'}:
    case {'russian': 'FIXME job'}:
        print({
            'english': '"I work here at the stables, taking care of the horses."',
            'russian': 'FIXME "I work here at the stables, taking care of the horses."'
        })
        wait()

        print({
            'english': '\n\n"You can @buy one if you\'d like."',
            'russian': 'FIXME \n\n"You can @buy one if you\'d like."'
        })
        jump label_185

    case {'english': 'ed'}:
    case {'russian': 'FIXME ed'}:
    case {'english': 'smit'}:
    case {'russian': 'FIXME smit'}:
    case {'english': 'talk'}:
    case {'russian': 'FIXME talk'}:
        print({
            'english': '"A talking horse? Ridiculous! Who told you that?"',
            'russian': 'FIXME "A talking horse? Ridiculous! Who told you that?"'
        })
        wait()

        print({
            'english': '\n\nHe seems more nervous than before.',
            'russian': 'FIXME \n\nHe seems more nervous than before.'
        })
        jump label_185

    case {'english': 'hors'}:
    case {'russian': 'FIXME hors'}:
        print({
            'english': '"Aye, if you wish to @buy one, just say the word."',
            'russian': 'FIXME "Aye, if you wish to @buy one, just say the word."'
        })
        jump label_185

    case {'english': 'buy'}:
    case {'russian': 'FIXME buy'}:
        jump label_550

    case {'english': 'bye'}:
    case {'russian': 'FIXME bye'}:
        print({
            'english': '"Come back again!"\n',
            'russian': 'FIXME "Come back again!"\n'
        })
        bye()

    case '*':
        print({
            'english': '"Beg pardon, $G?"',
            'russian': 'FIXME "Beg pardon, $G?"'
        })
        jump label_185
    esac

label_550:
    if greater(integer(value 23), byte 0):
        integer(value 1) = byte 0
        integer(value 2) = byte 0
        integer(value 4) = byte 0
        jump label_650
    fi

    integer(value 3) = character(byte 0, byte 0)

    if hasHorse(integer(value 3)):
        print({
            'english': '"But thou already hast a horse!"',
            'russian': 'FIXME "But thou already hast a horse!"'
        })
        jump label_185

    else:
        integer(value 4) = byte 1
        jump label_951
    fi

label_650:
    if greater(integer(value 1), integer(value 23)):
        jump label_757
    fi

    integer(value 3) = character(integer(value 1), byte 0)

    if hasHorse(integer(value 3)):
        jump label_742
    fi

    if equals(integer(value 4), byte 0):
        integer(value 4) = integer(value 3)
        integer(value 2) = plus(integer(value 2), byte 1)
        jump label_742
    fi

    look(integer(value 4))
    print({
        'english': '#2) $Y\n',
        'russian': 'FIXME #2) $Y\n'
    })
    integer(value 2) = plus(integer(value 2), byte 1)
    integer(value 4) = integer(value 3)

label_742:
    integer(value 1) = plus(integer(value 1), byte 1)
    jump label_650

label_757:
    if equals(integer(value 2), byte 0):
        print({
            'english': '"But all of you are already on horses!"',
            'russian': 'FIXME "But all of you are already on horses!"'
        })
        jump label_185
    fi

    if equals(integer(value 2), byte 1):
        integer(value 3) = integer(value 4)
        jump label_951
    fi

    look(integer(value 4))
    print({
        'english': '#2) $Y\n',
        'russian': 'FIXME #2) $Y\n'
    })
    integer(value 4) = byte 0
    print({
        'english': '"Which of you?" ',
        'russian': 'FIXME "Which of you?" '
    })
    inputInteger(integer(value 2))

    if equals(integer(value 2), byte 0):
        jump label_186
    fi

    integer(value 1) = byte 0

label_886:
    integer(value 3) = character(integer(value 1), byte 0)

    if equals(hasHorse(integer(value 3)), byte 0):
        integer(value 2) = minus(integer(value 2), byte 1)
    fi

    if equals(integer(value 2), byte 0):
        jump label_951
    fi

    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 1), integer(value 23)):
        jump label_886
    fi

label_951:
    look(integer(value 3))
    print({
        'english': '"Aye, $Y, thou hast need of a horse."',
        'russian': 'FIXME "Aye, $Y, thou hast need of a horse."'
    })
    wait()

    print({
        'english': '\n\n',
        'russian': 'FIXME \n\n'
    })

    if less(objectsCount(integer(value 3), byte 88), integer(value 9)):
        print({
            'english': '"But thou canst not afford one!"',
            'russian': 'FIXME "But thou canst not afford one!"'
        })
        jump label_1231
    fi

    print({
        'english': '"My price is #9 gold pieces, no less. Interested?" ',
        'russian': 'FIXME "My price is #9 gold pieces, no less. Interested?" '
    })

    choice({
        'english': 'yn',
        'russian': 'FIXME yn'
    })

    case {'english': 'y'}:
    case {'russian': 'FIXME y'}:
        print({
            'english': '"Good!" $N takes $Y\'s gold, and hands over the reins of a fine horse.',
            'russian': 'FIXME "Good!" $N takes $Y\'s gold, and hands over the reins of a fine horse.'
        })
        destroyItem(integer(value 3), byte 88, byte 0, integer(value 9))
        createHorse(integer(value 3))
        jump label_1231

    case {'english': 'n'}:
    case {'russian': 'FIXME n'}:
        print({
            'english': '"Perhaps some other time then."',
            'russian': 'FIXME "Perhaps some other time then."'
        })
        jump label_1231
    esac

label_1231:
    if integer(value 4):
        jump label_185
    fi

    wait()

    print({
        'english': '\n\n"How about ',
        'russian': 'FIXME \n\n"How about '
    })

    if greater(integer(value 23), byte 1):
        print({
            'english': 'one of thy friends',
            'russian': 'FIXME one of thy friends'
        })

    else:
        print({
            'english': 'thy friend',
            'russian': 'FIXME thy friend'
        })
    fi

    print({
        'english': '?"',
        'russian': 'FIXME ?"'
    })
    wait()

    print({
        'english': '\n\n',
        'russian': 'FIXME \n\n'
    })
    integer(value 1) = byte 0
    integer(value 2) = byte 0
    integer(value 4) = byte 0
    jump label_650
