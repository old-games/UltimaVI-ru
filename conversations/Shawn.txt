source('CONVERSE.B')
index(19)

id(118)
name('Shawn')

description:
    print('a charismatic man with an engaging smile.')
    wait()

    print('\n')

interaction:
    if hasBit(byte 235, value 0):
        print('"Welcome back, stranger." He winks at you.\n')

    else:
        print('"Welcome." He makes a sweeping gesture with his hat.\n')
    fi

label_156:
    ask()

    case 'name':
        print('"Shawn, friend."\n')
        ('SETF', ('byte', 235), ('value', 0))
        jump label_156

    case 'buy':
        print('"Which: @ham, @ale, @mead, @wine, or @rations?"\n')
        jump label_156

    case 'job':
        print('"I sell @ham, @ale, @mead, @wine, and @rations."\n')
        jump label_156

    case 'ham':
        jump label_1018

    case 'mead':
        integer(value 4) = byte 0
        jump label_528

    case 'ale':
        integer(value 4) = byte 1
        jump label_528

    case 'wine':
        integer(value 4) = byte 2
        jump label_528

    case 'rati':
        jump label_1471

    case 'shaw':
        print('"That\'s it."\n')
        jump label_156

    case 'bye':
        print('"I\'m glad you stopped by." He gives you a firm handshake.\n')
        bye()

    case '*':
        print('"I\'m sorry. Perhaps you could ask someone else."\n')
    esac

    jump label_156

label_528:
    if equals(integer(value 23), byte 0):
        integer(value 3) = character(byte 0, byte 0)
        jump label_692
    fi

label_551:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_565:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#2. $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_565
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        print('"Very well..."\n')
        jump label_156
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_551
    fi

    integer(value 3) = character(integer(value 3), byte 0)

label_692:
    ('SETNAME', ('integer', [('value', 3)]))
    integer(value 1) = data(dword 2217, integer(value 4))
    print('$N smiles at $Y and says, "That will cost you #1 gold. Interested?" ')

    choice('yn')

    case 'y':
        jump label_812

    case 'n':
        print('"Very well..."\n')
        jump label_156
    esac

label_812:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, integer(value 1))), weight(data(dword 2223, integer(value 4)), byte 1)):
        print('"You can\'t carry it, $Y."\n')
        jump label_156
    fi

    if greaterOrEquals(objectsCount(integer(value 3), byte 88), integer(value 1)):
        ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('integer', [('value', 1)]))
        ('NEW', ('integer', [('value', 3)]), ('data', [('dword', 2223), ('integer', [('value', 4)])]), ('byte', 0), ('byte', 1))
        print('"Fine!" After accepting $Y\'s gold, $N hands over the purchase.\n')
        jump label_156

    else:
        print('"You don\'t have enough gold, $Y."\n')
        jump label_156
    fi

label_1018:
    if equals(integer(value 23), byte 0):
        integer(value 3) = character(byte 0, byte 0)
        jump label_1182
    fi

label_1041:
    integer(value 0) = byte 0
    integer(value 2) = byte 1

label_1055:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#2. $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 2) = plus(integer(value 2), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_1055
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        print('"Very well..."\n')
        jump label_156
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_1041
    fi

    integer(value 3) = character(integer(value 3), byte 0)

label_1182:
    ('SETNAME', ('integer', [('value', 3)]))
    print('"It\'ll cost you 5 gold for the ham. Interested?" ')

    choice('yn')

    case 'y':
        if less(plus(canCarry(integer(value 3)), weight(byte 88, byte 5)), weight(byte 133, byte 1)):
            print('"You can\'t carry it, $Y."\n')
            jump label_156
        fi

        if greaterOrEquals(objectsCount(integer(value 3), byte 88), byte 5):
            ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('byte', 5))
            ('NEW', ('integer', [('value', 3)]), ('byte', 133), ('byte', 0), ('byte', 1))
            print('"Excellent!" After accepting the gold, $N serves $Y the ham.\n')
            jump label_156

        else:
            print('"How were you looking to pay for the meal? Eh?"\n')
            jump label_156
        fi

    case 'n':
        print('"Very well..."\n')
        jump label_156
    esac

label_1471:
    if equals(integer(value 23), byte 0):
        integer(value 3) = character(byte 0, byte 0)
        jump label_1635
    fi

label_1494:
    integer(value 0) = byte 0
    integer(value 1) = byte 1

label_1508:
    ('SETNAME', ('character', [('integer', [('value', 0)]), ('byte', 0)]))
    print('#1. $Y\n')
    integer(value 0) = plus(integer(value 0), byte 1)
    integer(value 1) = plus(integer(value 1), byte 1)

    if lessOrEquals(integer(value 0), integer(value 23)):
        jump label_1508
    fi

    print('"Which of you?" ')
    ('INPUTNUM', 3)

    if equals(integer(value 3), byte 0):
        print('"Very well..."\n')
        jump label_156
    fi

    integer(value 3) = minus(integer(value 3), byte 1)

    if greater(integer(value 3), integer(value 23)):
        jump label_1494
    fi

    integer(value 3) = character(integer(value 3), byte 0)

label_1635:
    ('SETNAME', ('integer', [('value', 3)]))

    if or(less(plus(canCarry(integer(value 3)), weight(byte 88, byte 4)), weight(byte 129, byte 1)), less(objectsCount(integer(value 3), byte 88), byte 4)):
        integer(value 5) = byte 1
        jump label_1899
    fi

label_1678:
    print('$N looks at $Y and says, "It\'ll cost you 4 gold for each ration. How ')
    print('many do you want?" ')
    ('INPUT', 5)

    if greater(integer(value 5), byte 100):
        print('"Come now, that\'s a little much, don\'t you think?"')
        wait()

        print('\n\n')
        jump label_1678
    fi

    if equals(integer(value 5), byte 0):
        print('$N frowns at $Y and says, "That was a good price."\n')
        jump label_156
    fi

label_1899:
    integer(value 2) = integer(value 5)
    integer(value 0) = byte 0
    integer(value 1) = byte 0

label_1920:
    if less(plus(canCarry(integer(value 3)), weight(byte 88, multiply(byte 4, integer(value 2)))), weight(byte 129, integer(value 2))):
        integer(value 1) = byte 1
        integer(value 0) = byte 1
        integer(value 2) = minus(integer(value 2), byte 1)
        jump label_2011
    fi

    if less(objectsCount(integer(value 3), byte 88), multiply(integer(value 2), byte 4)):
        integer(value 1) = byte 2
        integer(value 2) = minus(integer(value 2), byte 1)
        jump label_2011
    fi

    jump label_2139

label_2011:
    if integer(value 2):
        jump label_1920
    fi

    if equals(integer(value 1), byte 1):
        print('"You haven\'t any room in your pack, $Y."\n')
        jump label_156
    fi

    if equals(integer(value 1), byte 2):
        print('"Mutton rations cost more gold than you have, $Y."\n')
        jump label_156
    fi

label_2139:
    ('DELETE', ('integer', [('value', 3)]), ('byte', 88), ('byte', 0), ('multiply', [('integer', [('value', 2)]), ('byte', 4)]))
    ('NEW', ('integer', [('value', 3)]), ('byte', 129), ('byte', 0), ('integer', [('value', 2)]))
    print('He hands $Y #2 mutton ration\\s.')
    wait()

    print('\n\n')
    ('DPRINT', ('dword', 2243), ('integer', [('value', 1)]))
    print('\n')
    jump label_156

integers_2217 = [
    5, // 0
    3, // 1
    4, // 2
]

integers_2223 = [
    116,   // 0
    117,   // 1
    115,   // 2
    25933, // 3
    25697, // 4
    16640, // 5
    25964, // 6
    22272, // 7
    28265, // 8
    101,   // 9
]

strings_2243 = [
    '"There ya go."',                // 0
    '"That\'s all you can carry."',  // 1
    '"That\'s all you can afford."', // 2
]
